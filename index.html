<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FUNKENFLUG v3.0 - High Stakes</title>
    
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-glass: rgba(20, 20, 20, 0.95);
            --gold: #d4af37;
            --gold-light: #f4d03f;
            --gold-dark: #b8960c;
            --danger: #ff3333;
            --success: #00c853;
            --accent: #2979ff;
            --text: #ffffff;
            --text-secondary: #888888;
            --border: rgba(212, 175, 55, 0.3);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Helvetica Neue', system-ui, sans-serif;
            user-select: none;
        }

        html, body { 
            height: 100%; 
            background: var(--bg-primary); 
            color: var(--text); 
            overflow: hidden; 
            position: fixed; 
            width: 100%;
        }

        /* Hauptcontainer - Alles auf einer Seite */
        .app { 
            display: flex; 
            flex-direction: column; 
            height: 100%; 
            position: relative;
            background: radial-gradient(ellipse at top, #1a1a1a 0%, #000000 70%);
        }

        /* Unsichtbare Header-Leiste */
        .header { 
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            padding: 0 20px; 
            padding-top: env(safe-area-inset-top, 10px);
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
            pointer-events: none;
        }

        .header > * {
            pointer-events: auto;
        }

        .logo {
            font-size: 18px;
            font-weight: 300;
            letter-spacing: 4px;
            color: var(--gold);
            text-transform: uppercase;
        }

        .pot-indicator {
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            color: var(--gold);
            display: none;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(10px);
        }

        .pot-indicator.active {
            display: flex;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }
        }

        /* Content-Bereich */
        .content { 
            flex: 1; 
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Overlay-System statt Seiten */
        .overlay {
            position: absolute;
            inset: 0;
            background: var(--bg-primary);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .overlay.active {
            display: flex;
            opacity: 1;
        }

        /* Glassmorphism Cards */
        .glass-card {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        /* Spieler-Queue (unten) */
        .player-queue {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 50;
            transition: transform 0.3s ease, opacity 0.3s;
        }

        .player-queue.hidden {
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
        }

        .player-chip {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            transition: all 0.3s;
            white-space: nowrap;
        }

        .player-chip.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
            transform: scale(1.1);
            font-weight: 600;
        }

        .player-chip.out {
            opacity: 0.2;
            text-decoration: line-through;
        }

        /* Haupt-Spielkarte */
        .game-card {
            background: linear-gradient(135deg, rgba(20,20,20,0.95) 0%, rgba(10,10,10,0.98) 100%);
            border: 1px solid var(--border);
            border-radius: 32px;
            padding: 40px 30px;
            width: 90%;
            max-width: 380px;
            text-align: center;
            position: relative;
            overflow: hidden;
            display: none;
            box-shadow: 0 0 60px rgba(212, 175, 55, 0.1);
        }

        .game-card.active {
            display: block;
            animation: cardEnter 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes cardEnter {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .card-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }

        .card-type {
            font-size: 11px;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 24px;
            font-weight: 600;
        }

        .card-content {
            font-size: 24px;
            line-height: 1.4;
            font-weight: 300;
            margin-bottom: 30px;
            color: var(--text);
        }

        .tabu-forbidden {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }

        .tabu-word {
            background: rgba(255, 51, 51, 0.1);
            color: var(--danger);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            border: 1px solid rgba(255, 51, 51, 0.3);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-gold {
            background: var(--gold);
            color: #000;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }

        .btn-danger {
            background: rgba(255, 51, 51, 0.1);
            color: var(--danger);
            border: 1px solid rgba(255, 51, 51, 0.3);
        }

        .btn-success {
            background: rgba(0, 200, 83, 0.1);
            color: var(--success);
            border: 1px solid rgba(0, 200, 83, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* Floating Action Button Bereich */
        .fab-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            padding-bottom: env(safe-area-inset-bottom, 20px);
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 40;
        }

        .fab-container.active {
            display: flex;
        }

        /* Dice Animation */
        .dice-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .dice {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 1px solid var(--border);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .dice:active {
            transform: scale(0.9);
        }

        .dice.rolling {
            animation: rollDice 0.5s infinite;
        }

        @keyframes rollDice {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Modal Overlays */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
        }

        /* Wett-Interface */
        .bet-interface {
            background: var(--bg-glass);
            border: 1px solid var(--gold);
            border-radius: 24px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
        }

        .bet-title {
            font-size: 20px;
            color: var(--gold);
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .bet-input {
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            color: var(--text);
            font-size: 16px;
            margin-bottom: 16px;
            outline: none;
        }

        .bet-input:focus {
            border-color: var(--gold);
        }

        .bet-info {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Blackjack Compact */
        .bj-table {
            background: rgba(0,50,0,0.3);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(0,200,83,0.3);
        }

        .bj-hand {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
            min-height: 80px;
        }

        .bj-card {
            width: 50px;
            height: 75px;
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            color: #000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .bj-card.red {
            color: var(--danger);
        }

        .bj-card.hidden {
            background: linear-gradient(135deg, #b91c1c, #7f1d1d);
            color: transparent;
        }

        /* Start Screen Elegant */
        .start-screen {
            text-align: center;
        }

        .main-title {
            font-size: 48px;
            font-weight: 100;
            letter-spacing: 12px;
            color: var(--gold);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 12px;
            letter-spacing: 6px;
            color: var(--text-secondary);
            margin-bottom: 60px;
            text-transform: uppercase;
        }

        .feature-tags {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .tag {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 11px;
            color: var(--gold);
            letter-spacing: 1px;
        }

        /* Utility */
        .hidden { display: none !important; }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive */
        @media (max-height: 700px) {
            .main-title { font-size: 36px; }
            .card-content { font-size: 20px; }
            .dice { width: 80px; height: 80px; font-size: 36px; }
        }
    </style>
</head>
<body>

    <div class="app">
        <!-- Header mit Pot-Anzeige -->
        <div class="header">
            <div class="logo">FUNKENFLUG</div>
            <div class="pot-indicator" id="potIndicator">
                <span>üé∞</span>
                <span id="potText">POT AKTIV</span>
            </div>
        </div>

        <!-- Haupt-Content -->
        <div class="content">
            
            <!-- START SCREEN -->
            <div id="overlay-start" class="overlay active start-screen">
                <div class="main-title">FUNKEN<br>FLUG</div>
                <div class="subtitle">High Stakes Edition</div>
                
                <div class="feature-tags">
                    <span class="tag">‚ö° 4 Modi</span>
                    <span class="tag">üé≤ Blackjack</span>
                    <span class="tag">üî• Risiko x2</span>
                </div>

                <div style="width: 100%; max-width: 300px;">
                    <button class="btn btn-gold" onclick="game.showLobby()" style="margin-bottom: 12px; height: 56px;">Neues Spiel</button>
                    <button class="btn" onclick="game.showRules()">Spielregeln</button>
                </div>
            </div>

            <!-- LOBBY -->
            <div id="overlay-lobby" class="overlay">
                <div class="glass-card">
                    <div style="font-size: 20px; color: var(--gold); margin-bottom: 24px; text-align: center; letter-spacing: 2px;">SPIELER</div>
                    <div id="lobbyList" style="margin-bottom: 20px;"></div>
                    <button class="btn" onclick="game.addPlayer()" style="margin-bottom: 12px; font-size: 24px; line-height: 0;">+</button>
                    <button class="btn btn-gold" onclick="game.startGame()" id="btnStart" style="margin-bottom: 12px;">Start</button>
                    <button class="btn" onclick="game.showStart()">Zur√ºck</button>
                </div>
            </div>

            <!-- GAME AREA -->
            <div id="overlay-game" class="overlay" style="padding: 0;">
                <!-- Dice View -->
                <div id="view-dice" class="dice-container">
                    <div class="dice" onclick="game.roll()">üé≤</div>
                    <div class="dice" onclick="game.roll()">üî•</div>
                </div>

                <!-- Cards -->
                <div id="card-action" class="game-card">
                    <div class="card-glow"></div>
                    <div class="card-type">‚ö° Aktion</div>
                    <div class="card-content" id="text-action"></div>
                    <div id="sub-action" style="color: var(--gold); font-size: 14px;"></div>
                </div>

                <div id="card-quiz" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, var(--accent), transparent);"></div>
                    <div class="card-type" style="color: var(--accent);">üß† Quiz</div>
                    <div class="card-content" id="text-quiz" style="font-size: 20px;"></div>
                    <div class="quiz-options" id="quiz-options"></div>
                </div>

                <div id="card-tabu" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, var(--success), transparent);"></div>
                    <div class="card-type" style="color: var(--success);">üö´ Tabu</div>
                    <div class="card-content" id="text-tabu" style="font-size: 28px; font-weight: 600; text-transform: uppercase;"></div>
                    <div class="tabu-forbidden" id="list-tabu"></div>
                </div>

                <div id="card-z" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, var(--danger), transparent);"></div>
                    <div class="card-type" style="color: var(--danger);">üî• Z√ºndstoff</div>
                    <div class="card-content" id="text-z" style="font-size: 22px;"></div>
                </div>

                <div id="card-chaos" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, #ff00ff, transparent); box-shadow: 0 0 30px rgba(255,0,255,0.5);"></div>
                    <div class="card-type" style="color: #ff00ff;">‚ö†Ô∏è Chaos Event</div>
                    <div class="card-content" id="text-chaos" style="color: #ff00ff; font-size: 20px;"></div>
                    <div id="sub-chaos" style="color: var(--text-secondary); font-size: 14px; margin-top: 10px;"></div>
                </div>
            </div>

            <!-- BET MODAL (Wette erstellen) -->
            <div id="modal-bet" class="modal">
                <div class="bet-interface">
                    <div class="bet-title">Einsatz Setzen</div>
                    <div class="bet-info">
                        Du hast nur noch 1 Kleidungsst√ºck!<br>
                        Setze einen Einsatz um zu bleiben.
                    </div>
                    <input type="text" class="bet-input" id="videoUrl" placeholder="Video-Link hier einf√ºgen...">
                    <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                        <button class="btn" onclick="game.setBetRounds(1)" id="btnRounds1" style="flex: 1;">1 Runde<br><small>10s/Item</small></button>
                        <button class="btn" onclick="game.setBetRounds(3)" id="btnRounds3" style="flex: 1; opacity: 0.5;">3 Runden<br><small>Risiko x3</small></button>
                    </div>
                    <div id="betSummary" style="font-size: 13px; color: var(--gold); text-align: center; margin-bottom: 20px; min-height: 40px;">
                        W√§hle die Anzahl der Runden
                    </div>
                    <button class="btn btn-gold" onclick="game.confirmBet()">Einsatz Best√§tigen</button>
                    <button class="btn btn-danger" onclick="game.fold()" style="margin-top: 10px;">Aufgeben (Out)</button>
                </div>
            </div>

            <!-- CHALLENGE MODAL (Einsatz herausfordern) -->
            <div id="modal-challenge" class="modal">
                <div class="bet-interface">
                    <div class="bet-title">Einsatz Herausfordern</div>
                    <div class="bet-info" id="challengeInfo">
                        Spieler X hat einen Einsatz gesetzt.<br>
                        Fordere ihn heraus f√ºr die gleiche Anzahl Items.
                    </div>
                    <div style="background: rgba(212,175,55,0.1); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border);">
                        <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 5px;">Aktueller Einsatz:</div>
                        <div id="currentPotDetails" style="font-size: 14px; color: var(--gold);"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="game.acceptChallenge(1)">1 Runde<br>Spielen</button>
                        <button class="btn btn-success" onclick="game.acceptChallenge(3)" style="background: rgba(255,165,0,0.2); color: #ffa500; border-color: rgba(255,165,0,0.3);">3 Runden<br>Risiko x3</button>
                    </div>
                    <button class="btn" onclick="game.declineChallenge()" style="margin-top: 12px;">Ablehnen</button>
                </div>
            </div>

            <!-- OVERBID MODAL (√úberbieten) -->
            <div id="modal-overbid" class="modal">
                <div class="bet-interface">
                    <div class="bet-title">Einsatz √úberbieten</div>
                    <div class="bet-info">
                        +5 Sekunden = +1 Kleidungsst√ºck<br>
                        Jede zus√§tzliche 5s gibt 1 Bonus-Item
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin: 30px 0;">
                        <button class="btn" onclick="game.adjustOverbid(-5)" style="width: 50px; height: 50px; border-radius: 50%; padding: 0; font-size: 24px;">-</button>
                        <div style="text-align: center;">
                            <div id="overbidTime" style="font-size: 32px; color: var(--gold); font-weight: 700;">+0s</div>
                            <div id="overbidBonus" style="font-size: 12px; color: var(--success); margin-top: 5px;">+0 Items</div>
                        </div>
                        <button class="btn" onclick="game.adjustOverbid(5)" style="width: 50px; height: 50px; border-radius: 50%; padding: 0; font-size: 24px;">+</button>
                    </div>
                    <button class="btn btn-gold" onclick="game.confirmOverbid()">√úberbieten</button>
                    <button class="btn" onclick="game.closeOverbid()" style="margin-top: 10px;">Abbrechen</button>
                </div>
            </div>

            <!-- BLACKJACK CHALLENGE -->
            <div id="modal-bj-challenge" class="modal">
                <div class="glass-card" style="max-width: 360px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 12px; color: var(--gold); letter-spacing: 2px; margin-bottom: 5px;">HIGH STAKES CHALLENGE</div>
                        <div style="font-size: 20px; font-weight: 700;">Blackjack</div>
                        <div id="bjRoundInfo" style="font-size: 11px; color: var(--text-secondary); margin-top: 5px;">Runde 1/3</div>
                    </div>

                    <div class="bj-table">
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">
                            <span id="bjOppName">Gegner</span>
                            <span id="bjOppScore" style="color: var(--gold); font-weight: 700;">?</span>
                        </div>
                        <div class="bj-hand" id="bjOppHand"></div>
                    </div>

                    <div style="text-align: center; font-size: 11px; color: #666; margin: 10px 0;">
                        Wer n√§her an 21 gewinnt
                    </div>

                    <div class="bj-table" style="border-color: var(--gold);">
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">
                            <span>DU</span>
                            <span id="bjPlayerScore" style="color: var(--gold); font-weight: 700;">0</span>
                        </div>
                        <div class="bj-hand" id="bjPlayerHand"></div>
                    </div>

                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn" onclick="game.bjStand()" style="height: 50px;">STOP</button>
                        <button class="btn btn-gold" onclick="game.bjHit()" style="height: 50px;">KARTE</button>
                    </div>
                </div>
            </div>

            <!-- RESULT -->
            <div id="overlay-result" class="overlay">
                <div class="glass-card" style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üèÜ</div>
                    <div style="font-size: 14px; color: var(--text-secondary); letter-spacing: 4px; margin-bottom: 10px;">GEWINNER</div>
                    <div id="winnerName" style="font-size: 28px; color: var(--gold); font-weight: 300; letter-spacing: 2px; margin-bottom: 30px;">-</div>
                    <button class="btn btn-gold" onclick="game.reset()">Neue Runde</button>
                </div>
            </div>

            <!-- Player Queue (Bottom) -->
            <div class="player-queue hidden" id="playerQueue"></div>

            <!-- FAB Container -->
            <div class="fab-container" id="fabContainer">
                <button class="btn" onclick="game.showBj()" id="btnHighStakes" style="background: rgba(255,165,0,0.1); color: #ffa500; border: 1px solid rgba(255,165,0,0.3); margin-bottom: 8px; display: none;">
                    üé∞ High Stakes Challenge
                </button>
                <div class="btn-group" id="gameControls">
                    <button class="btn btn-danger" onclick="game.fail()">Strip (-1)</button>
                    <button class="btn btn-success" onclick="game.success()">Geschafft ‚úì</button>
                </div>
                <button class="btn btn-gold" onclick="game.next()" id="btnNext" style="display: none;">Weiter ‚Üí</button>
            </div>

        </div>
    </div>

    <script>
        // ==========================================
        // FUNKENFLUG v3.0 - HIGH STAKES EDITION
        // ==========================================

        const DECKS = {
            standard: {
                actions: [
                    {t: "Tausche dein Oberteil mit links", i: 3}, {t: "Lass dich 30s kitzeln", i: 2},
                    {t: "Fl√ºstere ein Geheimnis ins Ohr", i: 4}, {t: "Trinke ohne H√§nde", i: 3},
                    {t: "Mach ein anz√ºgliches Kompliment", i: 2}, {t: "Ziehe etwas aus", i: 5},
                    {t: "Wahrheit oder Strip?", i: 4}, {t: "Simuliere sexy Werbung", i: 3},
                    {t: "Massiere die Schultern", i: 2}, {t: "Spiele Porno-Szene nach", i: 5},
                    {t: "Errate wer dich ber√ºhrt (blind)", i: 3}, {t: "Tausche den Platz", i: 2},
                    {t: "Zeige Dirty Talk Gesicht", i: 3}, {t: "Iss Eisw√ºrfel aus Dekollet√©", i: 4},
                    {t: "Erz√§hle peinlichste Sex-Story", i: 4}, {t: "Gib einen leidenschaftlichen Kuss", i: 3},
                    {t: "Lecke Schokolade vom Bauch", i: 5}, {t: "Mache einen Striptease (30s)", i: 5},
                    {t: "Tausche alle Klamotten mit rechts", i: 4}, {t: "Body-Scan der Person links", i: 4}
                ],
                quiz: [
                    {q: "Wie viele Schritte pro Tag (Durchschnitt)?", a: ["3.000", "10.000", "15.000"], c: 1},
                    {q: "Gr√∂√ütes innere Organ?", a: ["Herz", "Leber", "Lunge"], c: 1},
                    {q: "Z√§hne Erwachsener?", a: ["28", "32", "36"], c: 1},
                    {q: "Erstes iPhone Jahr?", a: ["2005", "2007", "2009"], c: 1},
                    {q: "Hauptstadt Australien?", a: ["Sydney", "Melbourne", "Canberra"], c: 2},
                    {q: "Planeten im Sonnensystem?", a: ["7", "8", "9"], c: 1},
                    {q: "Element 'Au'?", a: ["Silber", "Aluminium", "Gold"], c: 2},
                    {q: "Oscars f√ºr Titanic?", a: ["9", "11", "13"], c: 1},
                    {q: "Wie viele Herzen hat ein Oktopus?", a: ["1", "2", "3"], c: 2},
                    {q: "Gr√∂√ütes Land der Welt?", a: ["China", "USA", "Russland"], c: 2}
                ],
                tabu: [
                    {w: "Orgasmus", f: ["H√∂hepunkt", "Lust", "Kommen"]}, {w: "Kondom", f: ["Gummi", "Schutz", "Verh√ºtung"]},
                    {w: "Tinder", f: ["Dating", "Swipe", "Match"]}, {w: "Kamasutra", f: ["Stellung", "Buch", "Sex"]},
                    {w: "Striptease", f: ["Ausziehen", "Tanz", "Club"]}, {w: "One-Night-Stand", f: ["Sex", "Nacht", "Fremder"]},
                    {w: "Viagra", f: ["Potenz", "Pille", "Stehen"]}, {w: "Aphrodisiakum", f: ["Lust", "Mittel", "Essen"]},
                    {w: "Dreier", f: ["Sex", "Drei", "Gruppe"]}, {w: "Bondage", f: ["Seil", "Fesseln", "BDSM"]}
                ],
                z: ["Geheimste sexuelle Fantasie?", "Mit wem hier w√ºrdest du schlafen?", "Verruchteste Tat?", "Letzter Sex-Traum?", 
                    "Welche K√∂rperstelle macht dich am meisten an?", "Lieblingsstellung?", "Peinlichster Sex-Moment?", "Dominant oder devot?",
                    "Schonmal betrogen?", "Wann war dein letzter Sex?", "Gr√∂√üte Abturn?", "Schonmal ein Video gemacht?",
                    "Schonmal im Freien?", "Lieblings-Toy?", "Schonmal mit gleichem Geschlecht?"]
            }
        };

        const CHAOS_EVENTS = [
            {n: "IDENTIT√ÑTSTAUSCH", t: "Tausche deine Identit√§t!", d: "Du spielst als die Person rechts.", e: "swap"},
            {n: "DOPPELTER EINSATZ", t: "Alles z√§hlt doppelt!", d: "Strips werden verdoppelt.", e: "double"},
            {n: "ZWANGS-BLACKJACK", t: "Nur Blackjack z√§hlt!", d: "Verlust = -3 Strips", e: "bjforced"},
            {n: "ROLLENTAUSCH", t: "Links wird Rechts", d: "Die Richtungen sind vertauscht.", e: "reverse"},
            {n: "ALLE GEGEN ALLE", t: "Jeder gegen Jeden!", d: "N√§chste Runde: Wer verliert, strippt alle.", e: "allvsall"}
        ];

        class FlowController {
            constructor() {
                this.energy = 50;
                this.history = [];
                this.chaosCooldown = 0;
                this.lastCategories = [];
                this.tensionPeaks = 0;
                this.flowState = 'balanced';
            }

            selectNextCategory(forceChaos = false) {
                if (forceChaos || (this.chaosCooldown >= 3 && Math.random() < this.getChaosChance())) {
                    this.chaosCooldown = 0;
                    this.energy = Math.min(100, this.energy + 30);
                    this.tensionPeaks++;
                    return 'chaos';
                }
                this.chaosCooldown++;

                const categories = ['action', 'quiz', 'tabu', 'z'];
                const available = categories.filter(c => !this.lastCategories.includes(c));
                const pool = available.length > 0 ? available : categories;
                
                let weights = {};
                pool.forEach(c => {
                    if (this.energy > 75) {
                        weights[c] = (c === 'quiz' || c === 'tabu') ? 3 : 1;
                    } else if (this.energy < 30) {
                        weights[c] = (c === 'action' || c === 'z') ? 3 : 1;
                    } else {
                        weights[c] = 2;
                    }
                });

                const result = this.weightedRandom(pool, weights);
                this.updateEnergy(result);
                this.lastCategories.push(result);
                if (this.lastCategories.length > 2) this.lastCategories.shift();
                
                return result;
            }

            getChaosChance() {
                if (this.energy > 70) return 0.4;
                if (this.energy < 30) return 0.1;
                return 0.25;
            }

            updateEnergy(category) {
                const changes = {
                    'action': +15, 'quiz': -10, 'tabu': -5, 'z': +20, 'chaos': +30
                };
                this.energy = Math.max(0, Math.min(100, this.energy + (changes[category] || 0)));
            }

            weightedRandom(items, weights) {
                const total = Object.values(weights).reduce((a,b) => a+b, 0);
                let random = Math.random() * total;
                for (let item of items) {
                    random -= weights[item];
                    if (random <= 0) return item;
                }
                return items[0];
            }

            addToHistory(type, task) {
                this.history.push({type, task, energy: this.energy, time: Date.now()});
                if (this.history.length > 20) this.history.shift();
            }

            getUniqueTask(category, deck) {
                const recentTasks = this.history.slice(-8).map(h => h.task);
                let attempts = 0;
                let task;
                do {
                    task = this.getRandomFromDeck(category, deck);
                    attempts++;
                } while (recentTasks.includes(task) && attempts < 10);
                return task;
            }

            getRandomFromDeck(cat, deck) {
                const arr = deck[cat === 'z' ? 'z' : cat === 'action' ? 'actions' : cat === 'quiz' ? 'quiz' : 'tabu'];
                return arr[Math.floor(Math.random() * arr.length)];
            }
        }

        class Game {
            constructor() {
                this.flow = new FlowController();
                this.session = null;
                this.pot = null; // {owner, videoUrl, baseTime, rounds, items, claimed, overbidTime, challenger}
                this.bj = null;
                this.betRounds = 1;
                this.overbidAmount = 0;
                this.init();
            }

            init() {
                this.showStart();
            }

            showStart() {
                document.querySelectorAll('.overlay').forEach(o => o.classList.remove('active'));
                document.getElementById('overlay-start').classList.add('active');
                document.getElementById('playerQueue').classList.add('hidden');
                document.getElementById('fabContainer').classList.remove('active');
                document.getElementById('potIndicator').classList.remove('active');
            }

            showLobby() {
                this.session = {players: [], current: 0, round: 0, potActive: false};
                this.addPlayer();
                this.addPlayer();
                document.querySelectorAll('.overlay').forEach(o => o.classList.remove('active'));
                document.getElementById('overlay-lobby').classList.add('active');
            }

            addPlayer() {
                if(this.session.players.length >= 8) return;
                const id = this.session.players.length;
                this.session.players.push({
                    id: id,
                    name: 'Spieler ' + (id + 1), 
                    clothes: 5, 
                    out: false,
                    betMade: false,
                    bonusItems: 0
                });
                this.renderLobby();
            }

            renderLobby() {
                const div = document.getElementById('lobbyList');
                div.innerHTML = '';
                this.session.players.forEach((p,i) => {
                    div.innerHTML += `
                        <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.1);">
                            <div style="width:36px;height:36px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-weight:700;font-size:14px;">${p.name[0]}</div>
                            <input value="${p.name}" onchange="game.session.players[${i}].name=this.value" 
                                style="flex:1;background:transparent;border:none;color:#fff;font-size:16px;outline:none;">
                            ${this.session.players.length > 2 ? 
                                `<button onclick="game.session.players.splice(${i},1);game.renderLobby()" 
                                    style="background:none;border:none;color:var(--danger);font-size:20px; width:36px;">√ó</button>` : 
                                '<div style="width:36px;"></div>'}
                        </div>
                    `;
                });
                document.getElementById('btnStart').disabled = this.session.players.length < 2;
            }

            startGame() {
                this.flow = new FlowController();
                this.pot = null;
                this.session.players.forEach(p => {
                    p.clothes = 5; 
                    p.out = false;
                    p.betMade = false;
                    p.bonusItems = 0;
                });
                this.session.current = 0;
                this.session.round = 0;
                this.session.potActive = false;
                
                document.querySelectorAll('.overlay').forEach(o => o.classList.remove('active'));
                document.getElementById('overlay-game').classList.add('active');
                document.getElementById('playerQueue').classList.remove('hidden');
                document.getElementById('fabContainer').classList.add('active');
                
                this.updateGameUI();
            }

            updateGameUI() {
                // Skip dead players
                let guard = 0;
                while(this.session.players[this.session.current]?.out && guard++ < 20) {
                    this.session.current = (this.session.current + 1) % this.session.players.length;
                }
                
                const alive = this.session.players.filter(p => !p.out);
                if(alive.length === 1) {
                    this.endGame(alive[0]);
                    return;
                }

                // Update Queue (keine Kleidungsst√ºck-Anzeige mehr!)
                const q = document.getElementById('playerQueue');
                q.innerHTML = '';
                this.session.players.forEach((p,i) => {
                    if(!p.out) {
                        const active = i === this.session.current;
                        const hasPot = this.pot && this.pot.owner === i;
                        q.innerHTML += `
                            <div class="player-chip ${active ? 'active' : ''} ${hasPot ? 'pot-owner' : ''}" 
                                 style="${hasPot ? 'border-color: var(--gold); box-shadow: 0 0 10px rgba(212,175,55,0.5);' : ''}">
                                ${p.name} ${hasPot ? 'üëë' : ''}
                            </div>
                        `;
                    }
                });

                // Reset view
                document.getElementById('view-dice').style.display = 'flex';
                document.querySelectorAll('.game-card').forEach(c => c.classList.remove('active'));
                document.getElementById('gameControls').style.display = 'flex';
                document.getElementById('btnNext').style.display = 'none';
                document.getElementById('btnHighStakes').style.display = 'none';
            }

            roll() {
                this.session.round++;
                document.getElementById('view-dice').style.display = 'none';
                
                const cat = this.flow.selectNextCategory();
                
                if(cat === 'chaos') {
                    this.showChaos();
                } else {
                    this.showCategory(cat);
                }
            }

            showChaos() {
                const c = CHAOS_EVENTS[Math.floor(Math.random() * CHAOS_EVENTS.length)];
                this.session.chaos = c;
                
                document.getElementById('card-chaos').classList.add('active');
                document.getElementById('text-chaos').innerText = c.t;
                document.getElementById('sub-chaos').innerText = c.d;
                
                if(c.e === 'swap') {
                    const next = (this.session.current + 1) % this.session.players.length;
                    if(!this.session.players[this.session.current].out && !this.session.players[next].out) {
                        const t = this.session.players[this.session.current].name;
                        this.session.players[this.session.current].name = this.session.players[next].name;
                        this.session.players[next].name = t;
                    }
                }
                
                this.flow.addToHistory('chaos', c.n);
            }

            showCategory(cat) {
                const deck = DECKS.standard;
                const task = this.flow.getUniqueTask(cat, deck);
                
                document.getElementById('card-' + cat).classList.add('active');
                
                if(cat === 'action') {
                    document.getElementById('text-action').innerText = task.t;
                    document.getElementById('sub-action').innerText = 'üî•'.repeat(task.i);
                } else if(cat === 'quiz') {
                    document.getElementById('text-quiz').innerText = task.q;
                    const opts = document.getElementById('quiz-options');
                    opts.innerHTML = '';
                    task.a.forEach((a, i) => {
                        opts.innerHTML += `<button class="btn" style="margin-bottom:8px; text-transform: none;" 
                            onclick="game.answerQuiz(${i===task.c})">${a}</button>`;
                    });
                } else if(cat === 'tabu') {
                    document.getElementById('text-tabu').innerText = task.w;
                    document.getElementById('list-tabu').innerHTML = task.f.map(x => 
                        `<div class="tabu-word">${x}</div>`).join('');
                } else if(cat === 'z') {
                    document.getElementById('text-z').innerText = task;
                }
                
                if(cat === 'quiz') {
                    document.getElementById('gameControls').style.display = 'none';
                }
                
                this.flow.addToHistory(cat, typeof task === 'string' ? task : task.t || task.q || task.w);
            }

            answerQuiz(correct) {
                if(correct) {
                    this.next();
                } else {
                    this.fail();
                }
            }

            success() {
                this.next();
            }

            fail() {
                let loss = 1;
                if(this.session.chaos?.e === 'double') loss = 2;
                
                const p = this.session.players[this.session.current];
                const newClothes = p.clothes - loss;
                
                // Pr√ºfe auf Pot-Regel (bei 1 oder weniger Items)
                if(newClothes <= 0 && !p.out) {
                    if(newClothes === 0 && !p.betMade && !this.session.potActive) {
                        // Optional: Letzte Chance - Pot setzen
                        this.offerBet();
                        return;
                    } else if(this.session.potActive && this.pot && this.pot.owner !== p.id) {
                        // Pr√ºfe ob Challenge m√∂glich
                        this.checkChallenge();
                        return;
                    } else {
                        p.out = true;
                        p.clothes = 0;
                        
                        // Wenn Pot-Besitzer ausscheidet
                        if(this.pot && this.pot.owner === p.id) {
                            this.resolvePot();
                        }
                    }
                } else {
                    p.clothes = newClothes;
                }
                
                this.next();
            }

            offerBet() {
                // Spieler kann Einsatz setzen um zu bleiben
                document.getElementById('modal-bet').classList.add('active');
                document.getElementById('videoUrl').value = '';
                this.setBetRounds(1);
            }

            setBetRounds(rounds) {
                this.betRounds = rounds;
                document.getElementById('btnRounds1').style.opacity = rounds === 1 ? '1' : '0.5';
                document.getElementById('btnRounds3').style.opacity = rounds === 3 ? '1' : '0.5';
                
                const p = this.session.players[this.session.current];
                const time = p.clothes * 10; // Pro Item 10 Sekunden
                const totalTime = time * rounds;
                
                document.getElementById('betSummary').innerHTML = `
                    ${p.clothes} Items √ó 10 Sekunden √ó ${rounds} Runde${rounds>1?'n':''}<br>
                    <strong>Gesamt: ${totalTime} Sekunden</strong><br>
                    <small style="color: var(--text-secondary)">Bei Verlust: ${rounds===3 ? '3x Zeitstrafe' : 'Sofortige Erf√ºllung'}</small>
                `;
            }

            confirmBet() {
                const url = document.getElementById('videoUrl').value.trim();
                if(!url) {
                    alert('Bitte Video-Link eingeben!');
                    return;
                }
                
                const p = this.session.players[this.session.current];
                const baseTime = p.clothes * 10;
                
                this.pot = {
                    owner: p.id,
                    videoUrl: url,
                    baseTime: baseTime,
                    rounds: this.betRounds,
                    items: p.clothes,
                    claimed: false,
                    overbidTime: 0,
                    challenger: null,
                    currentRound: 1
                };
                
                p.betMade = true;
                p.clothes = 0; // Vorl√§ufig out, kann durch Challenge zur√ºckgewonnen werden
                p.out = false; // Aber noch im Spiel f√ºr Challenges
                
                this.session.potActive = true;
                document.getElementById('modal-bet').classList.remove('active');
                document.getElementById('potIndicator').classList.add('active');
                document.getElementById('potText').innerText = `POT: ${baseTime}s`;
                
                this.next();
            }

            fold() {
                // Spieler gibt auf
                const p = this.session.players[this.session.current];
                p.out = true;
                document.getElementById('modal-bet').classList.remove('active');
                this.next();
            }

            checkChallenge() {
                // Pr√ºft ob andere Spieler den Pot herausfordern k√∂nnen
                const currentP = this.session.players[this.session.current];
                
                if(this.pot && this.pot.owner !== currentP.id && !currentP.betMade && currentP.clothes <= 0) {
                    // Zeige Challenge-Modal
                    document.getElementById('modal-challenge').classList.add('active');
                    const owner = this.session.players[this.pot.owner];
                    document.getElementById('challengeInfo').innerHTML = 
                        `<strong>${owner.name}</strong> hat einen Einsatz gesetzt.<br>
                         Fordere ihn heraus f√ºr <strong>${this.pot.items} Item(s)</strong>.`;
                    document.getElementById('currentPotDetails').innerHTML = 
                        `${this.pot.baseTime} Sekunden Video<br>1 Item = 10s`;
                } else {
                    // Nicht berechtigt oder kein Pot, normal out
                    currentP.out = true;
                    this.next();
                }
            }

            acceptChallenge(rounds) {
                const p = this.session.players[this.session.current];
                this.pot.challenger = p.id;
                this.pot.challengeRounds = rounds;
                
                document.getElementById('modal-challenge').classList.remove('active');
                this.startBjChallenge();
            }

            declineChallenge() {
                const p = this.session.players[this.session.current];
                p.out = true;
                document.getElementById('modal-challenge').classList.remove('active');
                this.next();
            }

            startBjChallenge() {
                // Starte Blackjack f√ºr den Pot
                const owner = this.session.players[this.pot.owner];
                const challenger = this.session.players[this.pot.challenger];
                
                this.bj = {
                    challenger: this.pot.challenger,
                    owner: this.pot.owner,
                    deck: this.createDeck(),
                    ph: [],
                    oh: [],
                    round: 1,
                    maxRounds: this.pot.challengeRounds || 1
                };
                
                // Deal
                this.bj.ph.push(this.bj.deck.pop(), this.bj.deck.pop());
                this.bj.oh.push(this.bj.deck.pop(), this.bj.deck.pop());
                
                document.getElementById('bjOppName').innerText = owner.name;
                document.getElementById('modal-bj-challenge').classList.add('active');
                document.getElementById('bjRoundInfo').innerText = `Runde ${this.bj.round}/${this.bj.maxRounds}`;
                
                this.updateBjUI();
            }

            createDeck() {
                const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
                const values = [
                    {v:2,l:'2'},{v:3,l:'3'},{v:4,l:'4'},{v:5,l:'5'},
                    {v:6,l:'6'},{v:7,l:'7'},{v:8,l:'8'},{v:9,l:'9'},
                    {v:10,l:'10'},{v:10,l:'B'},{v:10,l:'D'},
                    {v:10,l:'K'},{v:11,l:'A'}
                ];
                let deck = [];
                for(let s of suits) {
                    for(let v of values) {
                        deck.push({...v, s:s});
                    }
                }
                // Shuffle
                for(let i=deck.length-1; i>0; i--) {
                    const j = Math.floor(Math.random()*(i+1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
                return deck;
            }

            calcHand(hand) {
                let sum = 0, aces = 0;
                for(let c of hand) {
                    sum += c.v;
                    if(c.l === 'A') aces++;
                }
                while(sum > 21 && aces > 0) {
                    sum -= 10;
                    aces--;
                }
                return sum;
            }

            updateBjUI() {
                const render = (hand, hide=false) => {
                    return hand.map((c,i) => {
                        if(hide && i === 1) return '<div class="bj-card hidden"></div>';
                        const isRed = c.s === '‚ô•' || c.s === '‚ô¶';
                        return `<div class="bj-card ${isRed?'red':''}">${c.l}${c.s}</div>`;
                    }).join('');
                };

                document.getElementById('bjPlayerHand').innerHTML = render(this.bj.ph);
                document.getElementById('bjPlayerScore').innerText = this.calcHand(this.bj.ph);
                document.getElementById('bjOppHand').innerHTML = render(this.bj.oh, true);
                document.getElementById('bjOppScore').innerText = '?';
            }

            bjHit() {
                this.bj.ph.push(this.bj.deck.pop());
                this.updateBjUI();
                if(this.calcHand(this.bj.ph) >= 21) {
                    setTimeout(() => this.bjStand(), 500);
                }
            }

            bjStand() {
                // Reveal opponent
                document.getElementById('bjOppHand').innerHTML = this.bj.oh.map(c => {
                    const isRed = c.s === '‚ô•' || c.s === '‚ô¶';
                    return `<div class="bj-card ${isRed?'red':''}">${c.l}${c.s}</div>`;
                }).join('');
                
                // AI Draw
                let oppScore = this.calcHand(this.bj.oh);
                while(oppScore < 17) {
                    this.bj.oh.push(this.bj.deck.pop());
                    oppScore = this.calcHand(this.bj.oh);
                }
                
                document.getElementById('bjOppHand').innerHTML = this.bj.oh.map(c => {
                    const isRed = c.s === '‚ô•' || c.s === '‚ô¶';
                    return `<div class="bj-card ${isRed?'red':''}">${c.l}${c.s}</div>`;
                }).join('');
                document.getElementById('bjOppScore').innerText = oppScore;
                
                setTimeout(() => this.resolveBjRound(), 1000);
            }

            resolveBjRound() {
                const pScore = this.calcHand(this.bj.ph);
                const oScore = this.calcHand(this.bj.oh);
                const challenger = this.session.players[this.bj.challenger];
                const owner = this.session.players[this.bj.owner];
                
                let challengerWon = false;
                
                if(pScore > 21) challengerWon = false;
                else if(oScore > 21) challengerWon = true;
                else if(pScore > oScore) challengerWon = true;
                else if(pScore < oScore) challengerWon = false;
                else challengerWon = false; // Unentschieden = Owner gewinnt
                
                if(challengerWon) {
                    // Challenger gewinnt Items zur√ºck
                    challenger.clothes += this.pot.items;
                    challenger.bonusItems += Math.floor(this.pot.overbidTime / 5); // Bonus f√ºr √úberbietung
                    
                    if(this.bj.round >= this.bj.maxRounds) {
                        // Challenge gewonnen, Pot √ºbernehmen
                        this.pot.owner = challenger.id;
                        alert(`Gewonnen! Du √ºbernimmst den Einsatz.`);
                        this.endBjChallenge();
                    } else {
                        // N√§chste Runde
                        this.bj.round++;
                        this.bj.ph = [];
                        this.bj.oh = [];
                        this.bj.ph.push(this.bj.deck.pop(), this.bj.deck.pop());
                        this.bj.oh.push(this.bj.deck.pop(), this.bj.deck.pop());
                        document.getElementById('bjRoundInfo').innerText = `Runde ${this.bj.round}/${this.bj.maxRounds}`;
                        this.updateBjUI();
                    }
                } else {
                    // Challenger verliert
                    const multiplier = this.pot.challengeRounds === 3 ? 3 : 1;
                    const penalty = this.pot.baseTime * multiplier;
                    
                    alert(`Verloren! Strafe: ${penalty} Sekunden Video nachspielen.`);
                    challenger.out = true;
                    this.endBjChallenge();
                }
            }

            endBjChallenge() {
                document.getElementById('modal-bj-challenge').classList.remove('active');
                this.bj = null;
                
                // Pr√ºfe ob nur noch Owner √ºbrig
                const alive = this.session.players.filter(p => !p.out);
                if(alive.length === 1 && this.pot && alive[0].id === this.pot.owner) {
                    this.resolvePot();
                }
                
                this.next();
            }

            resolvePot() {
                // Pot wird eingel√∂st wenn Owner allein √ºbrig oder ausgeschieden
                if(this.pot) {
                    const owner = this.session.players[this.pot.owner];
                    if(!owner.out) {
                        // Owner bekommt Kleidung zur√ºck falls er noch im Spiel
                        owner.clothes = this.pot.items;
                    }
                    this.pot = null;
                    this.session.potActive = false;
                    document.getElementById('potIndicator').classList.remove('active');
                }
            }

            next() {
                this.session.chaos = null;
                do {
                    this.session.current = (this.session.current + 1) % this.session.players.length;
                } while(this.session.players[this.session.current].out && this.session.players.some(p => !p.out));
                
                this.updateGameUI();
            }

            // High Stakes Blackjack (optional, nicht Challenge-bezogen)
            showBj() {
                // Normales Blackjack f√ºr aktuellen Spieler gegen zuf√§lligen Gegner
                const alive = this.session.players.filter(p => !p.out && p.id !== this.session.current);
                if(alive.length === 0) return;
                
                const opp = alive[Math.floor(Math.random() * alive.length)];
                
                this.bj = {
                    p: this.session.current,
                    o: opp.id,
                    deck: this.createDeck(),
                    ph: [],
                    oh: [],
                    casual: true
                };
                
                this.bj.ph.push(this.bj.deck.pop(), this.bj.deck.pop());
                this.bj.oh.push(this.bj.deck.pop(), this.bj.deck.pop());
                
                document.getElementById('bjOppName').innerText = opp.name;
                document.getElementById('bjRoundInfo').innerText = 'HIGH STAKES';
                document.getElementById('modal-bj-challenge').classList.add('active');
                this.updateBjUI();
            }

            endGame(winner) {
                document.querySelectorAll('.overlay').forEach(o => o.classList.remove('active'));
                document.getElementById('overlay-result').classList.add('active');
                document.getElementById('winnerName').innerText = winner.name;
                document.getElementById('playerQueue').classList.add('hidden');
                document.getElementById('fabContainer').classList.remove('active');
            }

            reset() {
                this.showStart();
            }
            
            showRules() {
                alert(`FUNKENFLUG v3.0 - High Stakes Edition
                
REGELN:
‚Ä¢ 5 Kleidungsst√ºcke pro Spieler (nicht sichtbar)
‚Ä¢ W√ºrfeln f√ºr Aufgaben: Action, Quiz, Tabu, Z√ºndstoff
‚Ä¢ Chaos Events f√ºr √úberraschungen

POT-SYSTEM:
‚Ä¢ Bei letztem Kleidungsst√ºck: Einsatz setzen mit Video-Link
‚Ä¢ 10s pro Item nachspielen bei Verlust
‚Ä¢ Andere k√∂nnen herausfordern (1x oder 3x Runden)
‚Ä¢ Gewinner √ºbernimmt den Pot

√úberbieten: +5s = +1 Bonus-Item`);
            }
        }

        const game = new Game();
    </script>
</body>
</html>
