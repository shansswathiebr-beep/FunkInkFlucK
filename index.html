<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FUNKENFLUG - High Stakes Edition</title>
    
    <style>
        :root {
            --gold: #d4a574;
            --gold-bright: #f0c890;
            --gold-muted: rgba(212, 165, 116, 0.2);
            --bg-card: #1a1a1a;
            --danger: #ff2d55;
            --danger-dim: rgba(255, 45, 85, 0.2);
            --quiz: #5856d6;
            --tabu: #34c759;
            --z√ºndstoff: #ff3b30;
            --blackjack: #ff9500;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at 50% 30%, #1a1a1a 0%, #000 100%);
            color: #fff;
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            overscroll-behavior: none;
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .screen.active { display: flex; }

        .watermark {
            position: fixed;
            bottom: 5px;
            width: 100%;
            text-align: center;
            font-size: 9px;
            color: rgba(212, 165, 116, 0.2);
            pointer-events: none;
            z-index: 1000;
            font-family: monospace;
            letter-spacing: 1px;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold), var(--gold-bright));
            transition: width 0.5s ease;
            z-index: 1001;
            box-shadow: 0 0 10px var(--gold);
        }

        /* START SCREEN */
        #startScreen {
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, #0d0d0d 0%, #000 100%);
            padding: 20px;
        }

        .logo {
            font-size: 12vw;
            font-weight: 100;
            letter-spacing: 0.2em;
            background: linear-gradient(to right, var(--gold), #fff, var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            line-height: 0.9;
            margin-bottom: 2vh;
            filter: drop-shadow(0 0 20px rgba(212, 165, 116, 0.3));
        }

        .logo-sub {
            color: var(--gold);
            font-size: 11px;
            letter-spacing: 0.4em;
            margin-bottom: 6vh;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .feature-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 5vh;
            flex-wrap: wrap;
            justify-content: center;
        }

        .badge {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(212, 165, 116, 0.3);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 10px;
            letter-spacing: 0.5px;
            color: var(--gold);
        }

        /* BUTTONS */
        .btn {
            width: 100%;
            height: 54px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn:active { transform: scale(0.96); }
        .btn:disabled { opacity: 0.3; pointer-events: none; }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold), #b8935f);
            color: #000;
            border: none;
            box-shadow: 0 4px 15px rgba(212, 165, 116, 0.3);
        }

        .btn-danger {
            background: var(--danger-dim);
            color: var(--danger);
            border-color: rgba(255,45,85,0.3);
        }

        .btn-blackjack {
            background: rgba(255, 149, 0, 0.15);
            color: var(--blackjack);
            border-color: rgba(255, 149, 0, 0.4);
            font-size: 12px;
            flex-direction: column;
            height: auto;
            min-height: 54px;
            padding: 8px;
            gap: 2px;
        }

        .btn-blackjack .small {
            font-size: 9px;
            opacity: 0.8;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        /* SETUP SCREEN */
        #setupScreen {
            padding: 20px;
            padding-top: max(var(--safe-top), 20px);
        }

        .setup-header {
            margin-bottom: 15px;
            margin-top: 10px;
        }

        .setup-header h2 {
            color: var(--gold);
            font-size: 24px;
            font-weight: 300;
            margin-bottom: 5px;
        }

        .setup-header p { color: #666; font-size: 13px; }

        .player-list {
            flex: 1;
            overflow-y: auto;
            margin: 10px 0;
            padding-bottom: 100px;
        }

        .player-input {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn { 
            from { opacity: 0; transform: translateX(-20px); } 
            to { opacity: 1; transform: translateX(0); } 
        }

        .player-input input {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 16px;
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
        }

        .player-input input:focus { 
            border-color: var(--gold); 
            outline: none; 
        }

        .remove-player {
            background: var(--danger-dim);
            border: none;
            color: var(--danger);
            width: 46px;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
        }

        .setup-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px 20px calc(var(--safe-bottom) + 15px);
            background: linear-gradient(to top, rgba(0,0,0,0.95) 80%, transparent);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* GAME SCREEN */
        #gameScreen {
            padding: 15px;
            padding-top: max(var(--safe-top), 15px);
            padding-bottom: calc(var(--safe-bottom) + 10px);
        }

        .mode-indicator {
            position: absolute;
            top: max(var(--safe-top), 15px);
            right: 15px;
            font-size: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            z-index: 50;
            border: 1px solid;
            font-weight: 700;
        }

        .mode-indicator.action { color: var(--gold); border-color: var(--gold); }
        .mode-indicator.quiz { color: var(--quiz); border-color: var(--quiz); }
        .mode-indicator.tabu { color: var(--tabu); border-color: var(--tabu); }
        .mode-indicator.z√ºndstoff { color: var(--z√ºndstoff); border-color: var(--z√ºndstoff); }
        .mode-indicator.blackjack { color: var(--blackjack); border-color: var(--blackjack); }

        /* PLAYER QUEUE */
        .player-queue {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 5px 0;
            margin-bottom: 10px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .player-queue::-webkit-scrollbar { display: none; }

        .queue-item {
            flex-shrink: 0;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .queue-item.active {
            background: rgba(212, 165, 116, 0.2);
            border-color: var(--gold);
            color: var(--gold);
        }

        .queue-item.out {
            opacity: 0.3;
            text-decoration: line-through;
        }

        /* GAME HEADER */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .player-info { display: flex; flex-direction: column; }
        
        #currentPlayer {
            font-size: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gold);
        }

        .turn-indicator {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
            letter-spacing: 1px;
        }

        .clothes-display {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 3px;
        }

        .clothes-icons {
            font-size: 16px;
            letter-spacing: 1px;
        }

        .clothes-count-text {
            font-size: 10px;
            color: #666;
            letter-spacing: 0.5px;
        }

        /* GAME CONTENT */
        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px 0;
            margin-bottom: 10px;
        }

        /* DICE */
        .dice-wrapper {
            display: flex;
            gap: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20vh;
        }

        .dice-wrapper:active { transform: scale(0.92); }

        .die {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 2px solid var(--gold-muted);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .die.rolling { animation: shakeDice 0.5s ease-in-out infinite; }

        @keyframes shakeDice {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        /* CARDS */
        .card-container {
            width: 100%;
            max-width: 380px;
            display: none;
            animation: cardEnter 0.4s ease;
        }

        @keyframes cardEnter {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-container.active { display: block; }

        .card {
            background: linear-gradient(180deg, #1a1a1a 0%, #121212 100%);
            border-radius: 24px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .card.action::before { background: var(--gold); }
        .card.quiz::before { background: var(--quiz); }
        .card.tabu::before { background: var(--tabu); }
        .card.z√ºndstoff::before { background: var(--z√ºndstoff); }

        .card-label {
            font-size: 11px;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .card.action .card-label { color: var(--gold); }
        .card.quiz .card-label { color: var(--quiz); }
        .card.tabu .card-label { color: var(--tabu); }
        .card.z√ºndstoff .card-label { color: var(--z√ºndstoff); }

        .card-text {
            font-size: 18px;
            line-height: 1.4;
            font-weight: 400;
            margin-bottom: 15px;
            letter-spacing: 0.2px;
        }

        .card-sub {
            font-size: 12px;
            color: rgba(255,255,255,0.4);
            font-style: italic;
        }

        /* TABU SPECIFIC - OPTIMIZED */
        .tabu-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .tabu-word {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin: 10px 0;
            word-break: break-word;
            line-height: 1.2;
        }

        .tabu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 5px;
        }

        .tabu-item {
            background: rgba(255,59,48,0.15);
            color: var(--z√ºndstoff);
            padding: 10px 8px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            border: 1px solid rgba(255,59,48,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
        }

        /* QUIZ */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        .quiz-option {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
            text-align: left;
        }

        .quiz-option.correct { 
            background: rgba(52,199,89,0.2); 
            border-color: var(--tabu);
        }
        .quiz-option.wrong { 
            background: rgba(255,45,85,0.2); 
            border-color: var(--danger);
        }

        .quiz-answer-reveal {
            margin-top: 15px;
            padding: 15px;
            background: rgba(88,86,214,0.15);
            border-radius: 12px;
            font-size: 14px;
            display: none;
            border: 1px solid rgba(88,86,214,0.3);
        }

        /* FOOTER ACTIONS - FIXED */
        .footer-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-top: 5px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .btn-row {
            display: flex;
            gap: 8px;
        }

        .btn-row .btn { flex: 1; height: 50px; }

        /* BLACKJACK OVERLAY */
        .challenge-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #000;
            z-index: 200;
            display: none;
            flex-direction: column;
            padding: 15px;
            padding-top: max(var(--safe-top), 15px);
            padding-bottom: calc(var(--safe-bottom) + 15px);
        }

        .challenge-overlay.active { display: flex; }

        .challenge-header {
            text-align: center;
            margin-bottom: 15px;
            padding-top: 10px;
        }

        .challenge-title {
            font-size: 12px;
            letter-spacing: 3px;
            color: var(--blackjack);
            margin-bottom: 5px;
        }

        .challenge-subtitle {
            font-size: 18px;
            font-weight: 600;
        }

        .opponent-selector {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
            overflow-y: auto;
        }

        .opponent-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 16px;
            border-radius: 14px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .opponent-btn:active { background: rgba(255,149,0,0.1); border-color: var(--blackjack); }

        .blackjack-table {
            flex: 1;
            display: none;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px 0;
        }

        .blackjack-table.active { display: flex; }

        .bj-hand {
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .bj-hand.active { border-color: var(--blackjack); }

        .bj-player-name {
            font-size: 11px;
            letter-spacing: 2px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .bj-cards {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 10px 0;
            min-height: 70px;
        }

        .playing-card {
            width: 50px;
            height: 75px;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #000;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border: 1px solid #ddd;
        }

        .playing-card.red { color: #d32f2f; }
        .playing-card.hidden { 
            background: linear-gradient(135deg, #b91c1c 0%, #7f1d1d 100%);
            border: 2px solid #991b1b;
            color: transparent;
        }

        .bj-score {
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            color: var(--blackjack);
        }

        .bj-score.bust { color: var(--danger); }

        .bj-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .bj-btn {
            flex: 1;
            height: 50px;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            font-size: 14px;
        }

        .bj-btn-hit {
            background: var(--blackjack);
            color: #000;
        }

        .bj-btn-stand {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .bj-result {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20,20,20,0.98);
            border: 2px solid var(--gold);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 300;
            width: 85%;
            max-width: 320px;
        }

        .bj-result.show { display: block; animation: popIn 0.3s ease; }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .bj-result-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .bj-result-text {
            color: #999;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.4;
        }

        .winner-text { color: var(--tabu); }
        .loser-text { color: var(--danger); }

        .hidden { display: none !important; }

        /* Responsive tweaks */
        @media (max-height: 700px) {
            .card { padding: 20px 15px; }
            .card-text { font-size: 16px; }
            .tabu-word { font-size: 24px; }
            .die { width: 70px; height: 70px; font-size: 28px; }
            .game-header { margin-bottom: 5px; padding: 8px 0; }
            .player-queue { margin-bottom: 5px; }
        }

        @media (min-width: 400px) {
            .logo { font-size: 50px; }
            .card { padding: 30px 25px; }
            .playing-card { width: 55px; height: 80px; font-size: 22px; }
        }
    </style>
</head>
<body>

    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
    <div class="watermark">¬© 2026 Hans-Swathi Srikandaraja ‚Ä¢ 27804 Berne</div>

    <!-- START SCREEN -->
    <div id="startScreen" class="screen active">
        <div class="logo">FUNKEN<br>FLUG</div>
        <div class="logo-sub">High Stakes Edition</div>
        <div class="feature-badges">
            <span class="badge">‚ö° 4 Modi</span>
            <span class="badge">üé≤ Blackjack</span>
            <span class="badge">üî• Risiko x2</span>
        </div>
        <div style="width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 10px;">
            <button class="btn btn-gold" onclick="showScreen('setupScreen')">Neues Spiel</button>
            <button class="btn" onclick="showRules()">Spielregeln</button>
        </div>
    </div>

    <!-- SETUP SCREEN -->
    <div id="setupScreen" class="screen">
        <div class="setup-header">
            <h2>Spieler</h2>
            <p>Mindestens 2 Spieler, maximal 8</p>
        </div>
        
        <div class="player-list" id="playerList"></div>

        <div class="setup-footer">
            <button class="btn" onclick="addPlayer()" id="addPlayerBtn">+ Spieler hinzuf√ºgen</button>
            <button class="btn btn-gold" id="startBtn" onclick="startGame()" disabled>Spiel Starten</button>
        </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="gameScreen" class="screen">
        <div class="mode-indicator" id="modeIndicator" style="display:none">Action</div>
        
        <div class="player-queue" id="playerQueue"></div>

        <div class="game-header">
            <div class="player-info">
                <div id="currentPlayer">Name</div>
                <div class="turn-indicator">ist am Zug</div>
            </div>
            <div class="clothes-display">
                <div class="clothes-icons" id="clothesDisplay">üëïüëïüëïüëïüëï</div>
                <div class="clothes-count-text"><span id="clothesCount">5</span> √ºbrig</div>
            </div>
        </div>

        <div class="game-content" id="gameContent">
            
            <!-- Dice View -->
            <div id="diceView" class="dice-wrapper" onclick="roll()">
                <div class="die" id="die1">üé≤</div>
                <div class="die" id="die2">üî•</div>
            </div>

            <!-- Action Card -->
            <div id="actionCard" class="card-container">
                <div class="card action">
                    <div class="card-label">‚ö° Aktion</div>
                    <div class="card-text" id="actionText"></div>
                    <div class="card-sub" id="actionSub"></div>
                </div>
            </div>

            <!-- Quiz Card -->
            <div id="quizCard" class="card-container">
                <div class="card quiz">
                    <div class="card-label">üß† Quizduell</div>
                    <div class="card-text" id="quizText"></div>
                    <div class="quiz-options" id="quizOptions"></div>
                    <div class="quiz-answer-reveal" id="quizReveal"></div>
                </div>
            </div>

            <!-- Tabu Card - OPTIMIZED -->
            <div id="tabuCard" class="card-container">
                <div class="card tabu">
                    <div class="card-label">üö´ Tabu</div>
                    <div class="tabu-content">
                        <div class="card-text" style="font-size: 14px; margin-bottom: 5px;">Erkl√§re ohne zu sagen:</div>
                        <div class="tabu-word" id="tabuWord">SPEED-DATING</div>
                        <div class="tabu-grid" id="tabuList"></div>
                        <div class="card-sub" style="margin-top: 10px;">30 Sekunden Zeit!</div>
                    </div>
                </div>
            </div>

            <!-- Z√ºndstoff Card -->
            <div id="z√ºndstoffCard" class="card-container">
                <div class="card z√ºndstoff">
                    <div class="card-label">üî• Z√ºndstoff</div>
                    <div class="card-text" id="z√ºndstoffText"></div>
                    <div class="card-sub">Ehrlich antworten oder Strip!</div>
                </div>
            </div>

        </div>

        <!-- Standard Actions -->
        <div id="gameActions" class="footer-actions hidden">
            <button class="btn btn-blackjack" onclick="initiateBlackjack()">
                <span>üé≤ HIGH STAKES CHALLENGE</span>
                <span class="small">Gewinn: Frei | Verlust: -2 Strips</span>
            </button>
            <div class="btn-row">
                <button class="btn btn-danger" onclick="actionFail()">Strip (-1)</button>
                <button class="btn btn-gold" onclick="actionSuccess()">Geschafft ‚úì</button>
            </div>
        </div>

        <!-- Next Turn -->
        <div id="nextActions" class="footer-actions hidden">
            <button class="btn btn-gold" onclick="nextTurn()">N√§chster Spieler ‚Üí</button>
        </div>
    </div>

    <!-- CHALLENGE OVERLAY -->
    <div id="challengeOverlay" class="challenge-overlay">
        <div class="challenge-header">
            <div class="challenge-title">üé∞ HIGH STAKES</div>
            <div class="challenge-subtitle" id="challengeSubtitle">Gegner w√§hlen</div>
        </div>

        <div id="opponentSelect" class="opponent-selector"></div>

        <div id="blackjackGame" class="blackjack-table">
            <div class="bj-hand" id="opponentHand">
                <div class="bj-player-name" id="opponentName">Gegner</div>
                <div class="bj-cards" id="opponentCards"></div>
                <div class="bj-score" id="opponentScore">0</div>
            </div>

            <div style="text-align: center; padding: 10px;">
                <div style="font-size: 11px; color: #666; margin-bottom: 5px;">Wer n√§her an 21 gewinnt ‚Ä¢ Ass=11 ‚Ä¢ Bild=10</div>
            </div>

            <div class="bj-hand active" id="playerHand">
                <div class="bj-player-name">Du</div>
                <div class="bj-cards" id="playerCards"></div>
                <div class="bj-score" id="playerScore">0</div>
            </div>

            <div class="bj-controls">
                <button class="bj-btn bj-btn-hit" onclick="bjHit()" id="hitBtn">Karte</button>
                <button class="bj-btn bj-btn-stand" onclick="bjStand()" id="standBtn">Stop</button>
            </div>
        </div>

        <div class="bj-result" id="bjResult">
            <div class="bj-result-title" id="bjResultTitle">Gewonnen!</div>
            <div class="bj-result-text" id="bjResultText"></div>
            <button class="btn btn-gold" onclick="closeChallenge()" style="width: 100%;">Weiter</button>
        </div>
    </div>

    <script>
        // GAME DATA
        const gameData = {
            actions: [
                { text: "Tausche dein Oberteil mit der Person links von dir.", intensity: 3 },
                { text: "Lass dich 30 Sekunden lang von der Person rechts kitzeln.", intensity: 2 },
                { text: "Fl√ºstere der Person deiner Wahl ein schmutziges Geheimnis ins Ohr.", intensity: 4 },
                { text: "Trinke einen Schluck vom Getr√§nk deines Gegen√ºbers ohne H√§nde.", intensity: 3 },
                { text: "Mache der Person gegen√ºber ein extrem √ºbertriebenes anz√ºgliches Kompliment.", intensity: 2 },
                { text: "Ziehe ein Kleidungsst√ºck deiner Wahl aus.", intensity: 5 },
                { text: "Die Gruppe darf entscheiden: Wahrheit oder Strip?", intensity: 4 },
                { text: "Simuliere eine sexy Werbung f√ºr ein beliebiges Objekt im Raum.", intensity: 3 },
                { text: "Massiere die Schultern der Person neben dir f√ºr eine Runde.", intensity: 2 },
                { text: "Spiele eine Szene aus deinem Lieblingsporno nach (stumm).", intensity: 5 },
                { text: "Lass dir die Augen verbinden und errate, wer dich ber√ºhrt.", intensity: 3 },
                { text: "Tausche den Sitzplatz mit der Person, die dir am meisten gef√§llt.", intensity: 2 },
                { text: "Zeige der Gruppe dein bestes Dirty Talk-Gesicht.", intensity: 3 },
                { text: "Iss einen Eisw√ºrfel aus dem Dekollet√©/einem Sixpack der Person links.", intensity: 4 },
                { text: "Die Gruppe darf dein Profilbild bei Instagram kommentieren.", intensity: 2 },
                { text: "Mache 10 Kniebeugen auf dem Scho√ü der Person rechts.", intensity: 3 },
                { text: "Erz√§hle deine peinlichste Sex-Geschichte.", intensity: 4 },
                { text: "Gib der Person gegen√ºber einen Kuss auf die Wange oder den Mund.", intensity: 3 },
                { text: "Lecke etwas Schokolade/Sahne vom Bauch einer anderen Person.", intensity: 5 },
                { text: "Spiele 'Ich habe noch nie' - die Gruppe stellt 3 Runden.", intensity: 3 },
                { text: "Mache einen Striptease zu einem Song der Gruppenwahl.", intensity: 5 },
                { text: "Tausche alle Kleidungsst√ºcke mit der Person gegen√ºber (au√üer Unterw√§sche).", intensity: 4 },
                { text: "Lass dich von der Gruppe in eine verf√ºhrerische Pose bringen.", intensity: 3 },
                { text: "Benutze einen Gegenstand als Mikrofon und singe ein Liebeslied.", intensity: 2 },
                { text: "F√ºhre einen langsamen Body-Scan der Person links vor.", intensity: 4 }
            ],
            
            quiz: [
                { q: "Wie viele Schritte macht ein Mensch im Durchschnitt pro Tag?", options: ["3.000", "10.000", "15.000"], correct: 1, info: "Ca. 10.000 Schritte sind der Durchschnitt" },
                { q: "Welches ist das gr√∂√üte innere Organ des Menschen?", options: ["Herz", "Leber", "Lunge"], correct: 1, info: "Die Leber wiegt ca. 1,5kg" },
                { q: "Wie viele Z√§hne hat ein Erwachsener normalerweise?", options: ["28", "32", "36"], correct: 1, info: "32 Z√§hne inkl. Weisheitsz√§hne" },
                { q: "In welchem Jahr kam der erste iPhone heraus?", options: ["2005", "2007", "2009"], correct: 1, info: "Steve Jobs pr√§sentierte es 2007" },
                { q: "Wie hei√üt die Hauptstadt von Australien?", options: ["Sydney", "Melbourne", "Canberra"], correct: 2, info: "Canberra ist die Hauptstadt" },
                { q: "Wie viele Planeten hat unser Sonnensystem?", options: ["7", "8", "9"], correct: 1, info: "Seit 2006 nur noch 8 Planeten" },
                { q: "Welches chemische Element hat das Symbol 'Au'?", options: ["Silber", "Aluminium", "Gold"], correct: 2, info: "Au kommt von lateinisch 'aurum'" },
                { q: "Wie viele Oscars gewann 'Titanic'?", options: ["9", "11", "13"], correct: 1, info: "11 Oscars, genau wie Ben Hur" },
                { q: "Wer malte die Mona Lisa?", options: ["Michelangelo", "Leonardo da Vinci", "Raphael"], correct: 1, info: "Da Vinci malte sie 1503-1519" },
                { q: "Wie viele Sterne hat die EU-Flagge?", options: ["10", "12", "15"], correct: 1, info: "12 Sterne f√ºr Vollkommenheit" },
                { q: "Welcher Planet ist der Sonne am n√§chsten?", options: ["Venus", "Merkur", "Mars"], correct: 1, info: "Merkur ist der innerste Planet" },
                { q: "Wie viele Bundesl√§nder hat Deutschland?", options: ["14", "15", "16"], correct: 2, info: "16 Bundesl√§nder seit der Wiedervereinigung" },
                { q: "Welches ist das schnellste Lands√§ugetier?", options: ["Gepard", "L√∂we", "Gazelle"], correct: 0, info: "Geparden erreichen 110 km/h" },
                { q: "Wie viele Knochen hat ein Erwachsener?", options: ["206", "208", "210"], correct: 0, info: "Ein Baby hat √ºbrigens 270 Knochen" },
                { q: "In welchem Jahr endete der Zweite Weltkrieg?", options: ["1944", "1945", "1946"], correct: 1, info: "Die Kapitulation war im Mai 1945" },
                { q: "Welches ist das gr√∂√üte S√§ugetier der Welt?", options: ["Elefant", "Blauwal", "Giraffe"], correct: 1, info: "Blaue Wale werden 30m lang" },
                { q: "Wie viele Farben hat ein Regenbogen?", options: ["5", "6", "7"], correct: 2, info: "Rot, Orange, Gelb, Gr√ºn, Blau, Indigo, Violett" },
                { q: "Welches Land ist fl√§chenm√§√üig das gr√∂√üte?", options: ["China", "USA", "Russland"], correct: 2, info: "Russland ist 17 Millionen km¬≤ gro√ü" },
                { q: "Wie viele Herzen hat ein Oktopus?", options: ["1", "2", "3"], correct: 2, info: "Zwei f√ºr die Kiemen, eines f√ºr den K√∂rper" },
                { q: "Welches Element ist H2O?", options: ["Wasserstoff", "Sauerstoff", "Wasser"], correct: 2, info: "H2O ist die chemische Formel f√ºr Wasser" }
            ],

            tabu: [
                { word: "Orgasmus", forbidden: ["H√∂hepunkt", "Sex", "Lust", "Kommen", "Genuss"] },
                { word: "Kondom", forbidden: ["Gummi", "Schutz", "Sex", "Verh√ºtung", "T√ºte"] },
                { word: "Tinder", forbidden: ["Dating", "App", "Swipe", "Match", "Date"] },
                { word: "Viagra", forbidden: ["Potenz", "Pille", "Mann", "Stehen", "Medizin"] },
                { word: "Kamasutra", forbidden: ["Sex", "Stellung", "Buch", "Indien", "Liebe"] },
                { word: "Striptease", forbidden: ["Ausziehen", "Tanz", "Kleidung", "Club", "Sexy"] },
                { word: "One-Night-Stand", forbidden: ["Sex", "Nacht", "Fremder", "Beziehung", "ONS"] },
                { word: "Aphrodisiakum", forbidden: ["Lust", "Mittel", "Sex", "Essen", "Anregung"] },
                { word: "Lederpeitsche", forbidden: ["Schlagen", "Sex", "SM", "Dominant", "Haut"] },
                { word: "Schwarzes Loch", forbidden: ["Weltall", "Stern", "Verschwinden", "Gravitation", "Universum"] },
                { word: "Bitcoin", forbidden: ["Geld", "Krypto", "Digital", "M√ºnze", "Investieren"] },
                { word: "Karaoke", forbidden: ["Singen", "Mikrofon", "Musik", "Lied", "B√ºhne"] },
                { word: "Tequila", forbidden: ["Schnaps", "Mexiko", "Salz", "Zitrone", "Trinken"] },
                { word: "Kuscheln", forbidden: ["Liebe", "Bett", "Umarmung", "Z√§rtlich", "K√∂rper"] },
                { word: "Selbstbr√§uner", forbidden: ["Haut", "Braun", "Creme", "Sommer", "Gesicht"] },
                { word: "Speed-Dating", forbidden: ["Date", "Kennenlernen", "Zeit", "Tisch", "Single"] },
                { word: "Nacktbaden", forbidden: ["See", "Ohne", "Kleidung", "FKK", "Wasser"] },
                { word: "K√ºssen", forbidden: ["Lippen", "Mund", "Zunge", "Liebe", "Knutschen"] },
                { word: "Handschellen", forbidden: ["Polizei", "Fest", "Metall", "Schloss", "Gefangen"] },
                { word: "Dessous", forbidden: ["Unterw√§sche", "Sexy", "Spitze", "Frau", "Tragen"] }
            ],

            z√ºndstoff: [
                "Was ist deine geheimste sexuelle Fantasie?",
                "Mit wem aus dieser Runde w√ºrdest du am ehesten schlafen?",
                "Was ist das Verruchteste, das du je gemacht hast?",
                "Hast du schon mal jemanden in dieser Runde nackt gesehen?",
                "Was war dein letzter Sex-Traum?",
                "Welche K√∂rperstelle macht dich am meisten an?",
                "Hast du schon mal bei der Arbeit/Schule Sex gehabt?",
                "Was ist deine Lieblingsstellung?",
                "Mit wie vielen Personen hattest du bisher Sex?",
                "Hast du schon mal ein Video von dir gemacht?",
                "Was ist das Peinlichste, das dir beim Sex passiert ist?",
                "Bevorzugst du dominant oder devot?",
                "Was ist dein gr√∂√üter Abturn?",
                "Hast du schon mal jemanden betrogen?",
                "Wann hattest du das letzte Mal Sex?",
                "Was ist deine geheime Schw√§che?",
                "Hast du schon mal mit mehreren Personen gleichzeitig?",
                "Welches Spielzeug besitzt du?",
                "Was w√ºrdest du niemals im Bett machen?",
                "Wer hat die sch√∂nsten Augen in dieser Runde?",
                "Hast du schon mal Gef√ºhle f√ºr einen Ex gehabt w√§hrend du in einer Beziehung warst?",
                "Was ist das Versauteste, das du je gesagt hast?",
                "Bevorzugst du es bei Licht oder im Dunkeln?",
                "Was w√ºrdest du mit einer Person dieser Runde tun, wenn du eine Stunde lang unsichtbar w√§rst?"
            ]
        };

        // Game State
        let players = [];
        let currentIdx = 0;
        let usedContent = new Set();
        let currentMode = '';
        
        let bjGame = {
            active: false,
            challenger: null,
            opponent: null,
            playerHand: [],
            opponentHand: [],
            deck: [],
            turn: 'player'
        };

        function getUnusedItem(array, prefix) {
            const available = array.filter((_, idx) => !usedContent.has(prefix + idx));
            if(available.length === 0) {
                usedContent.clear();
                const idx = Math.floor(Math.random() * array.length);
                return { item: array[idx], index: idx };
            }
            const randomIdx = Math.floor(Math.random() * available.length);
            const originalIndex = array.indexOf(available[randomIdx]);
            usedContent.add(prefix + originalIndex);
            return { item: available[randomIdx], index: originalIndex };
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function showRules() {
            alert(`FUNKENFLUG - High Stakes Regeln:

üé≤ W√ºrfeln startet die Runde
üéØ Vier Modi: Aktion, Quiz, Tabu, Z√ºndstoff

‚ö° HIGH STAKES CHALLENGE:
Fordere einen Spieler zum Blackjack-Duell heraus!

üé∞ Regeln:
‚Ä¢ Wer n√§her an 21 kommt, gewinnt
‚Ä¢ Ass = 11, Bildkarten = 10
‚Ä¢ Gewinner: Frei, keine Strafe
‚Ä¢ Verlierer: -2 Kleidungsst√ºcke!

‚úÖ Geschafft = N√§chster Spieler
‚ùå Strip = -1 Kleidungsst√ºck`);
        }

        function addPlayer() {
            const list = document.getElementById('playerList');
            if(list.children.length >= 8) return;
            const div = document.createElement('div');
            div.className = 'player-input';
            div.innerHTML = `
                <input type="text" placeholder="Name..." oninput="checkStart()">
                <button class="remove-player" onclick="this.parentElement.remove(); checkStart()">√ó</button>
            `;
            list.appendChild(div);
            
            if(list.children.length >= 8) {
                document.getElementById('addPlayerBtn').disabled = true;
            }
            checkStart();
        }

        function checkStart() {
            const inputs = document.querySelectorAll('.player-input input');
            const valid = Array.from(inputs).filter(i => i.value.trim().length > 0);
            document.getElementById('startBtn').disabled = valid.length < 2;
        }

        function startGame() {
            const inputs = document.querySelectorAll('.player-input input');
            players = Array.from(inputs)
                .map(i => i.value.trim())
                .filter(name => name !== "")
                .map(name => ({ name: name, clothes: 5, out: false }));
            
            if(players.length < 2) return;
            
            currentIdx = 0;
            usedContent.clear();
            updatePlayerQueue();
            updateUI();
            showScreen('gameScreen');
        }

        function updatePlayerQueue() {
            const queue = document.getElementById('playerQueue');
            queue.innerHTML = '';
            players.forEach((p, idx) => {
                const div = document.createElement('div');
                div.className = 'queue-item ' + (idx === currentIdx ? 'active' : '') + (p.out ? ' out' : '');
                div.innerHTML = `<span>${p.name}</span> <span>${p.clothes}xüëï</span>`;
                queue.appendChild(div);
            });
        }

        function updateUI() {
            while(players[currentIdx].out && players.filter(p => !p.out).length > 1) {
                currentIdx = (currentIdx + 1) % players.length;
            }
            
            const activePlayers = players.filter(p => !p.out);
            if(activePlayers.length === 1) {
                setTimeout(() => {
                    alert(`üèÜ ${activePlayers[0].name} hat gewonnen!`);
                    location.reload();
                }, 500);
                return;
            }

            const p = players[currentIdx];
            document.getElementById('currentPlayer').innerText = p.name;
            document.getElementById('clothesDisplay').innerText = "üëï".repeat(p.clothes) + "‚ùå".repeat(5-p.clothes);
            document.getElementById('clothesCount').innerText = p.clothes;
            document.getElementById('progressBar').style.width = ((usedContent.size / 80) * 100) + "%";
            
            updatePlayerQueue();
        }

        function roll() {
            const d1 = document.getElementById('die1');
            const d2 = document.getElementById('die2');
            
            d1.classList.add('rolling');
            d2.classList.add('rolling');
            document.getElementById('diceView').style.pointerEvents = 'none';

            setTimeout(() => {
                d1.classList.remove('rolling');
                d2.classList.remove('rolling');
                
                const rand = Math.random();
                if(rand < 0.4) showAction();
                else if(rand < 0.65) showQuiz();
                else if(rand < 0.85) showTabu();
                else showZ√ºndstoff();
                
            }, 600);
        }

        function hideAllCards() {
            document.querySelectorAll('.card-container').forEach(c => c.classList.remove('active'));
            document.getElementById('diceView').classList.add('hidden');
            document.getElementById('modeIndicator').style.display = 'block';
            document.getElementById('gameActions').classList.remove('hidden');
            document.getElementById('nextActions').classList.add('hidden');
        }

        function showAction() {
            currentMode = 'action';
            hideAllCards();
            document.getElementById('modeIndicator').className = 'mode-indicator action';
            document.getElementById('modeIndicator').innerText = '‚ö° Aktion';
            
            const { item } = getUnusedItem(gameData.actions, 'a');
            document.getElementById('actionText').innerText = item.text;
            document.getElementById('actionSub').innerText = "Intensit√§t: " + "üî•".repeat(item.intensity);
            document.getElementById('actionCard').classList.add('active');
        }

        function showQuiz() {
            currentMode = 'quiz';
            hideAllCards();
            document.getElementById('modeIndicator').className = 'mode-indicator quiz';
            document.getElementById('modeIndicator').innerText = 'üß† Quiz';
            document.getElementById('gameActions').classList.add('hidden');
            document.getElementById('nextActions').classList.remove('hidden');
            
            const { item } = getUnusedItem(gameData.quiz, 'q');
            document.getElementById('quizText').innerText = item.q;
            document.getElementById('quizReveal').style.display = 'none';
            
            const optsDiv = document.getElementById('quizOptions');
            optsDiv.innerHTML = '';
            
            item.options.forEach((opt, idx) => {
                const btn = document.createElement('div');
                btn.className = 'quiz-option';
                btn.innerText = opt;
                btn.onclick = function() {
                    document.querySelectorAll('.quiz-option').forEach(b => {
                        b.style.pointerEvents = 'none';
                        if(b.innerText === item.options[item.correct]) b.classList.add('correct');
                    });
                    if(idx !== item.correct) {
                        this.classList.add('wrong');
                        document.getElementById('quizReveal').innerHTML = `<strong>Falsch!</strong><br>${item.info}`;
                        document.getElementById('quizReveal').style.display = 'block';
                        setTimeout(() => actionFail(), 2000);
                    } else {
                        setTimeout(() => nextTurn(), 1500);
                    }
                };
                optsDiv.appendChild(btn);
            });
            
            document.getElementById('quizCard').classList.add('active');
        }

        function showTabu() {
            currentMode = 'tabu';
            hideAllCards();
            document.getElementById('modeIndicator').className = 'mode-indicator tabu';
            document.getElementById('modeIndicator').innerText = 'üö´ Tabu';
            
            const { item } = getUnusedItem(gameData.tabu, 't');
            document.getElementById('tabuWord').innerText = item.word;
            
            const list = document.getElementById('tabuList');
            list.innerHTML = '';
            item.forbidden.forEach(f => {
                const span = document.createElement('div');
                span.className = 'tabu-item';
                span.innerHTML = `‚ùå ${f}`;
                list.appendChild(span);
            });
            
            document.getElementById('tabuCard').classList.add('active');
        }

        function showZ√ºndstoff() {
            currentMode = 'z√ºndstoff';
            hideAllCards();
            document.getElementById('modeIndicator').className = 'mode-indicator z√ºndstoff';
            document.getElementById('modeIndicator').innerText = 'üî• Z√ºndstoff';
            
            const { item } = getUnusedItem(gameData.z√ºndstoff, 'z');
            document.getElementById('z√ºndstoffText').innerText = item;
            document.getElementById('z√ºndstoffCard').classList.add('active');
        }

        function actionSuccess() {
            nextTurn();
        }

        function actionFail() {
            const p = players[currentIdx];
            p.clothes--;
            if(p.clothes <= 0) {
                p.out = true;
                alert(`üíÄ ${p.name} ist ausgeschieden!`);
            }
            updateUI();
            nextTurn();
        }

        function nextTurn() {
            currentIdx = (currentIdx + 1) % players.length;
            updateUI();
            
            document.getElementById('diceView').classList.remove('hidden');
            document.querySelectorAll('.card-container').forEach(c => c.classList.remove('active'));
            document.getElementById('gameActions').classList.add('hidden');
            document.getElementById('nextActions').classList.add('hidden');
            document.getElementById('modeIndicator').style.display = 'none';
            document.getElementById('diceView').style.pointerEvents = 'auto';
        }

        // BLACKJACK
        function initiateBlackjack() {
            const overlay = document.getElementById('challengeOverlay');
            const select = document.getElementById('opponentSelect');
            const game = document.getElementById('blackjackGame');
            
            overlay.classList.add('active');
            select.style.display = 'flex';
            game.classList.remove('active');
            document.getElementById('bjResult').classList.remove('show');
            
            select.innerHTML = '';
            players.forEach((p, idx) => {
                if(idx !== currentIdx && !p.out && p.clothes > 0) {
                    const btn = document.createElement('div');
                    btn.className = 'opponent-btn';
                    btn.innerHTML = `<span>${p.name}</span><span style="opacity:0.6">${p.clothes} üëï</span>`;
                    btn.onclick = () => startBlackjackGame(idx);
                    select.appendChild(btn);
                }
            });
            
            if(select.children.length === 0) {
                select.innerHTML = '<div style="text-align:center;color:#666;padding:40px;">Keine geeigneten Gegner!</div>';
                setTimeout(closeChallenge, 1500);
            }
        }

        function createDeck() {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const values = [
                {v: 2, l: '2'}, {v: 3, l: '3'}, {v: 4, l: '4'}, {v: 5, l: '5'},
                {v: 6, l: '6'}, {v: 7, l: '7'}, {v: 8, l: '8'}, {v: 9, l: '9'},
                {v: 10, l: '10'}, {v: 10, l: 'B'}, {v: 10, l: 'D'}, {v: 10, l: 'K'}, {v: 11, l: 'A'}
            ];
            let deck = [];
            for(let s of suits) {
                for(let v of values) {
                    deck.push({...v, suit: s, red: s === '‚ô•' || s === '‚ô¶'});
                }
            }
            for(let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        function startBlackjackGame(opponentIdx) {
            bjGame.challenger = currentIdx;
            bjGame.opponent = opponentIdx;
            bjGame.deck = createDeck();
            bjGame.playerHand = [bjGame.deck.pop(), bjGame.deck.pop()];
            bjGame.opponentHand = [bjGame.deck.pop(), bjGame.deck.pop()];
            bjGame.turn = 'player';
            
            document.getElementById('opponentSelect').style.display = 'none';
            document.getElementById('blackjackGame').classList.add('active');
            document.getElementById('opponentName').innerText = players[opponentIdx].name;
            
            updateBJDisplay();
        }

        function getHandValue(hand) {
            let sum = 0;
            let aces = 0;
            for(let card of hand) {
                sum += card.v;
                if(card.l === 'A') aces++;
            }
            while(sum > 21 && aces > 0) {
                sum -= 10;
                aces--;
            }
            return sum;
        }

        function updateBJDisplay() {
            const pCards = document.getElementById('playerCards');
            const oCards = document.getElementById('opponentCards');
            const pScore = document.getElementById('playerScore');
            const oScore = document.getElementById('opponentScore');
            
            pCards.innerHTML = bjGame.playerHand.map(c => 
                `<div class="playing-card ${c.red ? 'red' : ''}">${c.l}${c.suit}</div>`
            ).join('');
            
            if(bjGame.turn === 'player') {
                oCards.innerHTML = `<div class="playing-card ${bjGame.opponentHand[0].red ? 'red' : ''}">${bjGame.opponentHand[0].l}${bjGame.opponentHand[0].suit}</div><div class="playing-card hidden">?</div>`;
                oScore.innerText = "?";
                oScore.className = 'bj-score';
            } else {
                oCards.innerHTML = bjGame.opponentHand.map(c => 
                    `<div class="playing-card ${c.red ? 'red' : ''}">${c.l}${c.suit}</div>`
                ).join('');
                const oVal = getHandValue(bjGame.opponentHand);
                oScore.innerText = oVal;
                oScore.className = 'bj-score' + (oVal > 21 ? ' bust' : '');
            }
            
            const pVal = getHandValue(bjGame.playerHand);
            pScore.innerText = pVal;
            pScore.className = 'bj-score' + (pVal > 21 ? ' bust' : '');
            
            document.getElementById('hitBtn').disabled = pVal >= 21;
            document.getElementById('standBtn').disabled = false;
        }

        function bjHit() {
            if(bjGame.turn !== 'player') return;
            bjGame.playerHand.push(bjGame.deck.pop());
            updateBJDisplay();
            
            if(getHandValue(bjGame.playerHand) >= 21) {
                setTimeout(bjStand, 500);
            }
        }

        function bjStand() {
            if(bjGame.turn !== 'player') return;
            bjGame.turn = 'opponent';
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
            updateBJDisplay();
            
            setTimeout(aiTurn, 1000);
        }

        function aiTurn() {
            let val = getHandValue(bjGame.opponentHand);
            while(val < 17 && bjGame.deck.length > 0) {
                bjGame.opponentHand.push(bjGame.deck.pop());
                val = getHandValue(bjGame.opponentHand);
            }
            updateBJDisplay();
            setTimeout(resolveBlackjack, 1500);
        }

        function resolveBlackjack() {
            const pVal = getHandValue(bjGame.playerHand);
            const oVal = getHandValue(bjGame.opponentHand);
            
            let winner = null;
            
            const pBust = pVal > 21;
            const oBust = oVal > 21;
            
            if(pBust && oBust) winner = 'draw';
            else if(pBust) winner = 'opponent';
            else if(oBust) winner = 'challenger';
            else if(pVal > oVal) winner = 'challenger';
            else if(oVal > pVal) winner = 'opponent';
            else winner = 'draw';
            
            let result = '';
            let consequence = '';
            
            if(winner === 'challenger') {
                result = `${pVal} vs ${oVal} - Du gewinnst!`;
                consequence = 'Du gehst frei! Kein Strip.';
                document.getElementById('bjResultTitle').innerText = 'SIEG!';
                document.getElementById('bjResultTitle').className = 'bj-result-title winner-text';
            } else if(winner === 'opponent') {
                const p = players[currentIdx];
                p.clothes = Math.max(0, p.clothes - 2);
                result = `${pVal} vs ${oVal} - Verloren!`;
                if(p.clothes <= 0) {
                    p.out = true;
                    consequence = 'üíÄ Ausgeschieden! -2 Strips';
                } else {
                    consequence = `Du verlierst 2 Strips! (${p.clothes} √ºbrig)`;
                }
                document.getElementById('bjResultTitle').innerText = 'NIEDERLAGE';
                document.getElementById('bjResultTitle').className = 'bj-result-title loser-text';
            } else {
                const p = players[currentIdx];
                p.clothes = Math.max(0, p.clothes - 1);
                if(p.clothes <= 0) p.out = true;
                result = 'Unentschieden! Beide -1 Strip.';
                consequence = 'Niemand gewinnt.';
                document.getElementById('bjResultTitle').innerText = 'DRAW';
                document.getElementById('bjResultTitle').style.color = '#ff9500';
            }
            
            document.getElementById('bjResultText').innerHTML = result + '<br><br>' + consequence;
            document.getElementById('bjResult').classList.add('show');
            updateUI();
        }

        function closeChallenge() {
            document.getElementById('challengeOverlay').classList.remove('active');
            nextTurn();
        }

        addPlayer();
        addPlayer();
    </script>
</body>
</html>
