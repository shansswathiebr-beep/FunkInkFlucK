<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FUNKENFLUG v3.5 ULTIMATE</title>
    
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-glass: rgba(20, 20, 20, 0.95);
            --gold: #d4af37;
            --gold-light: #f4d03f;
            --gold-dark: #b8960c;
            --danger: #ff3333;
            --success: #00c853;
            --accent: #2979ff;
            --text: #ffffff;
            --text-secondary: #888888;
            --border: rgba(212, 175, 55, 0.3);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Helvetica Neue', system-ui, -apple-system, sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        html, body { 
            height: 100%; 
            background: var(--bg-primary); 
            color: var(--text); 
            overflow: hidden; 
            position: fixed; 
            width: 100%;
            touch-action: manipulation;
        }

        .app { 
            display: flex; 
            flex-direction: column; 
            height: 100%; 
            position: relative;
            background: radial-gradient(ellipse at top, #1a1a1a 0%, #000000 70%);
        }

        .watermark {
            position: fixed;
            bottom: 8px;
            right: 8px;
            font-size: 8px;
            color: rgba(212, 175, 55, 0.25);
            text-align: right;
            line-height: 1.2;
            pointer-events: none;
            z-index: 9999;
            letter-spacing: 0.5px;
        }

        .lang-selector {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 5px;
            display: flex;
            gap: 4px;
        }

        .lang-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid transparent;
            background: transparent;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .lang-btn.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }

        .bot-moderator {
            position: fixed;
            top: 50px;
            left: 50%;
            transform: translateX(-50%) translateY(-100%);
            width: 90%;
            max-width: 380px;
            background: var(--bg-glass);
            border: 1px solid var(--gold);
            border-radius: 16px;
            padding: 12px 16px;
            z-index: 1001;
            display: flex;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            pointer-events: none;
        }

        .bot-moderator.active {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .bot-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            margin-right: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            background: rgba(212, 175, 55, 0.1);
        }

        .bot-content { flex: 1; min-width: 0; }
        .bot-name { 
            font-size: 11px; 
            color: var(--gold); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            font-weight: 700;
            margin-bottom: 3px;
        }
        .bot-text { 
            font-size: 13px; 
            font-style: italic; 
            line-height: 1.4; 
            color: var(--text);
        }

        .header { 
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            padding-top: env(safe-area-inset-top, 10px);
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
            pointer-events: none;
        }

        .header > * { pointer-events: auto; }

        .logo {
            font-size: 18px;
            font-weight: 300;
            letter-spacing: 4px;
            color: var(--gold);
            text-transform: uppercase;
        }

        .pot-indicator {
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            color: var(--gold);
            display: none;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(10px);
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .pot-indicator.active { display: flex; animation: pulse 2s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }
        }

        .content { 
            flex: 1; 
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: var(--bg-primary);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.4s ease;
            overflow-y: auto;
        }

        .overlay.active { display: flex; opacity: 1; }

        .glass-card {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 320px;
            margin-top: 30px;
        }

        .lang-btn-big {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text);
            padding: 16px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .lang-btn-big:hover, .lang-btn-big:active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
            transform: scale(0.98);
        }

        .player-queue {
            position: fixed;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 50;
            transition: all 0.3s ease;
            max-width: 92%;
            overflow-x: auto;
            padding: 0 10px;
            scrollbar-width: none;
        }

        .player-queue::-webkit-scrollbar { display: none; }
        .player-queue.hidden { transform: translateX(-50%) translateY(100px); opacity: 0; }
        .player-queue.compact { bottom: 140px; transform: translateX(-50%) scale(0.9); }

        .player-chip {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .player-chip.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
            transform: scale(1.1);
            font-weight: 600;
        }

        .player-chip.bot { border-color: rgba(41, 121, 255, 0.4); background: rgba(41, 121, 255, 0.15); color: var(--accent); }
        .player-chip.bot.active { background: var(--accent); color: white; border-color: var(--accent); }
        .player-chip.out { opacity: 0.2; text-decoration: line-through; }
        .player-chip.pot-owner { border-color: var(--gold); box-shadow: 0 0 10px rgba(212,175,55,0.5); }

        .game-card {
            background: linear-gradient(135deg, rgba(25,25,25,0.98) 0%, rgba(10,10,10,0.99) 100%);
            border: 1px solid var(--border);
            border-radius: 28px;
            padding: 35px 25px;
            width: 92%;
            max-width: 380px;
            text-align: center;
            position: relative;
            overflow: hidden;
            display: none;
            box-shadow: 0 0 60px rgba(212, 175, 55, 0.08);
        }

        .game-card.active { display: block; animation: cardEnter 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }

        @keyframes cardEnter {
            from { opacity: 0; transform: scale(0.9) translateY(30px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .card-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }

        .card-type {
            font-size: 11px;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 24px;
            font-weight: 600;
        }

        .card-content {
            font-size: 23px;
            line-height: 1.5;
            font-weight: 300;
            margin-bottom: 28px;
            color: var(--text);
            word-wrap: break-word;
        }

        .tabu-forbidden {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }

        .tabu-word {
            background: rgba(255, 51, 51, 0.12);
            color: var(--danger);
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 13px;
            border: 1px solid rgba(255, 51, 51, 0.3);
            font-weight: 500;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            touch-action: manipulation;
        }

        .btn:active { transform: scale(0.96); }

        .btn-gold {
            background: var(--gold);
            color: #000;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }

        .btn-danger {
            background: rgba(255, 51, 51, 0.1);
            color: var(--danger);
            border: 1px solid rgba(255, 51, 51, 0.3);
        }

        .btn-success {
            background: rgba(0, 200, 83, 0.1);
            color: var(--success);
            border: 1px solid rgba(0, 200, 83, 0.3);
        }

        .btn-ai {
            background: rgba(41, 121, 255, 0.15);
            color: var(--accent);
            border: 1px solid rgba(41, 121, 255, 0.3);
        }

        .btn-video {
            background: rgba(255, 0, 100, 0.15);
            color: #ff0066;
            border: 1px solid rgba(255, 0, 100, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn-group .btn { flex: 1; }

        .fab-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            padding-bottom: env(safe-area-inset-bottom, 20px);
            background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, transparent 100%);
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 40;
        }

        .fab-container.active { display: flex; }

        .dice-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .dice {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 1px solid var(--border);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .dice:active { transform: scale(0.9); }
        .dice.rolling { animation: rollDice 0.5s infinite; }

        @keyframes rollDice {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 2000;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal.active { display: flex; opacity: 1; }

        .bet-interface {
            background: var(--bg-glass);
            border: 1px solid var(--gold);
            border-radius: 24px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
        }

        .bet-title {
            font-size: 20px;
            color: var(--gold);
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(255,255,255,0.05);
            color: var(--text);
            margin-bottom: 12px;
            font-size: 15px;
            outline: none;
        }

        .input-field:focus { border-color: var(--gold); background: rgba(255,255,255,0.08); }

        .bj-table {
            background: rgba(0,50,0,0.3);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid rgba(0,200,83,0.3);
        }

        .bj-hand {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
            min-height: 80px;
            flex-wrap: wrap;
        }

        .bj-card {
            width: 50px;
            height: 75px;
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            color: #000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            flex-shrink: 0;
        }

        .bj-card.red { color: var(--danger); }
        .bj-card.hidden { background: linear-gradient(135deg, #b91c1c, #7f1d1d); color: transparent; }

        .start-screen { text-align: center; }

        .main-title {
            font-size: 48px;
            font-weight: 100;
            letter-spacing: 12px;
            color: var(--gold);
            margin-bottom: 10px;
            text-transform: uppercase;
            line-height: 1.1;
            text-shadow: 0 0 40px rgba(212, 175, 55, 0.3);
        }

        .subtitle {
            font-size: 12px;
            letter-spacing: 5px;
            color: var(--text-secondary);
            margin-bottom: 35px;
            text-transform: uppercase;
        }

        .feature-tags {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            padding: 0 20px;
        }

        .tag {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 11px;
            color: var(--gold);
            letter-spacing: 1px;
        }

        .tag.ai { background: rgba(41, 121, 255, 0.1); border-color: rgba(41, 121, 255, 0.3); color: var(--accent); }
        .tag.video { background: rgba(255, 0, 100, 0.1); border-color: rgba(255, 0, 100, 0.3); color: #ff0066; }

        .lobby-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.04);
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .lobby-item.bot { border-color: rgba(41, 121, 255, 0.3); background: rgba(41, 121, 255, 0.08); }

        .remove-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 51, 51, 0.2);
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .video-link-box {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,0,100,0.3);
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            font-size: 12px;
            color: var(--text-secondary);
            word-break: break-all;
        }

        .video-link-box a { color: #ff0066; text-decoration: none; }

        .hidden { display: none !important; }

        .toast {
            position: fixed; 
            top: 100px; 
            left: 50%; 
            transform: translateX(-50%);
            background: var(--gold); 
            color: #000; 
            padding: 12px 24px;
            border-radius: 12px; 
            font-weight: 600; 
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            max-width: 90%;
            text-align: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-height: 700px) {
            .main-title { font-size: 36px; letter-spacing: 8px; }
            .card-content { font-size: 20px; }
            .dice { width: 80px; height: 80px; font-size: 36px; }
            .player-queue { bottom: 160px; }
        }
    </style>
</head>
<body>

    <div class="watermark">
        <strong>¬© Hans-Swathi Srikandaraja</strong><br>
        27804 Berne<br>
        <span id="timestamp"></span>
    </div>

    <div class="lang-selector" id="langSelector" style="display: none;">
        <button class="lang-btn" data-lang="de" title="Deutsch">DE</button>
        <button class="lang-btn" data-lang="en" title="English">EN</button>
        <button class="lang-btn" data-lang="es" title="Espa√±ol">ES</button>
        <button class="lang-btn" data-lang="fr" title="Fran√ßais">FR</button>
        <button class="lang-btn" data-lang="it" title="Italiano">IT</button>
        <button class="lang-btn" data-lang="pt" title="Portugu√™s">PT</button>
        <button class="lang-btn" data-lang="nl" title="Nederlands">NL</button>
    </div>

    <div id="botBubble" class="bot-moderator">
        <div id="botAvatar" class="bot-avatar">ü§ñ</div>
        <div class="bot-content">
            <div class="bot-name" id="botSpeakerName">AI Moderator</div>
            <div class="bot-text" id="botSpeech">Ready?</div>
        </div>
    </div>

    <div class="app">
        <div class="header">
            <div class="logo" id="headerLogo">FUNKENFLUG</div>
            <div class="pot-indicator" id="potIndicator">
                <span>üî•</span>
                <span id="potText">POT</span>
            </div>
        </div>

        <div class="content">
            <!-- Language Selection -->
            <div id="overlay-language" class="overlay active">
                <div class="main-title" style="font-size: 32px; margin-bottom: 10px;">FUNKENFLUG</div>
                <div class="subtitle" id="langSubtitle">Choose your language</div>
                
                <div class="language-grid">
                    <button class="lang-btn-big" onclick="game.setLanguage('de')">üá©üá™ Deutsch</button>
                    <button class="lang-btn-big" onclick="game.setLanguage('en')">üá¨üáß English</button>
                    <button class="lang-btn-big" onclick="game.setLanguage('es')">üá™üá∏ Espa√±ol</button>
                    <button class="lang-btn-big" onclick="game.setLanguage('fr')">üá´üá∑ Fran√ßais</button>
                    <button class="lang-btn-big" onclick="game.setLanguage('it')">üáÆüáπ Italiano</button>
                    <button class="lang-btn-big" onclick="game.setLanguage('pt')">üáµüáπ Portugu√™s</button>
                    <button class="lang-btn-big" onclick="game.setLanguage('nl')">üá≥üá± Nederlands</button>
                </div>
            </div>

            <!-- Start Screen -->
            <div id="overlay-start" class="overlay start-screen">
                <div class="main-title">FUNKEN<br>FLUG</div>
                <div class="subtitle" id="startSubtitle">High Stakes AI Edition v3.5</div>
                
                <div class="feature-tags">
                    <span class="tag" id="tag1">‚ö° 5 Modes</span>
                    <span class="tag ai" id="tag2">ü§ñ AI Bots</span>
                    <span class="tag video" id="tag3">üé¨ Video</span>
                </div>

                <div style="width: 100%; max-width: 320px;">
                    <button class="btn btn-gold" onclick="game.showLobby()" id="btnNewGame" style="margin-bottom: 12px; height: 56px;">Neues Spiel</button>
                    <button class="btn btn-ai" onclick="game.demoMode()" id="btnDemo" style="margin-bottom: 12px; height: 56px;">üéÆ Demo (Bots)</button>
                    <button class="btn" onclick="game.showRules()" id="btnRules" style="margin-bottom: 12px; height: 56px;">üìã Regeln</button>
                    <button class="btn" onclick="game.showShare()" id="btnShare" style="margin-bottom: 12px; height: 56px;">üíå Dating Share</button>
                    <button class="btn" onclick="game.showLanguage()" style="height: 44px; opacity: 0.8;">üåê Sprache</button>
                </div>
            </div>

            <!-- Lobby -->
            <div id="overlay-lobby" class="overlay">
                <div class="glass-card">
                    <div style="font-size: 20px; color: var(--gold); margin-bottom: 20px; text-align: center; letter-spacing: 2px; font-weight: 300;" id="lobbyTitle">SPIELER & BOTS</div>
                    
                    <input type="text" class="input-field" id="playerName" placeholder="Dein Name..." maxlength="15">
                    
                    <div id="lobbyList" style="margin-bottom: 16px; max-height: 200px; overflow-y: auto;"></div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                        <button class="btn" onclick="game.addPlayer(false)" id="btnAddHuman" style="flex: 1; font-size: 13px;">+ Mensch</button>
                        <button class="btn btn-ai" onclick="game.addPlayer(true)" id="btnAddBot" style="flex: 1; font-size: 13px;">+ KI Bot</button>
                    </div>
                    <button class="btn btn-gold" onclick="game.startGame()" id="btnStart" style="margin-bottom: 12px;" disabled>Start (Min. 2)</button>
                    <button class="btn" onclick="game.showStart()" id="btnBack">Zur√ºck</button>
                </div>
            </div>

            <!-- Rules -->
            <div id="overlay-rules" class="overlay">
                <div class="glass-card">
                    <div style="font-size: 18px; color: var(--gold); margin-bottom: 16px; letter-spacing: 2px; font-weight: 300;" id="rulesTitle">SPIELREGELN</div>
                    <div id="rulesText" style="text-align: left; font-size: 13px; line-height: 1.6; color: #888; max-height: 60vh; overflow-y: auto;"></div>
                    <!-- HIER IST DIE KORREKTUR: onclick="game.closeRules()" statt hideAllOverlays() -->
                    <button class="btn btn-gold" onclick="game.closeRules()" id="btnUnderstood" style="margin-top: 20px;">Verstanden!</button>
                </div>
            </div>

            <!-- Share -->
            <div id="overlay-share" class="overlay">
                <div class="glass-card" style="max-width: 360px;">
                    <div style="font-size: 18px; color: var(--gold); margin-bottom: 20px; text-align: center; letter-spacing: 2px; font-weight: 300;" id="shareTitle">DATING APP SHARE</div>
                    
                    <div style="background: rgba(212,175,55,0.08); padding: 16px; border-radius: 12px; margin-bottom: 16px; border: 1px solid var(--border);">
                        <div style="font-size: 11px; color: var(--gold); margin-bottom: 8px; font-weight: 600;">BIO-TEXT</div>
                        <div id="bioText" style="font-size: 13px; color: var(--text); font-style: italic; line-height: 1.5;">
                            üî• High Stakes Funkenflug! Strip-Quests, KI-Bots & Blackjack. Trau dich?
                        </div>
                    </div>

                    <button class="btn btn-gold" onclick="game.copyToClipboard('bio')" id="btnCopyBio" style="margin-bottom: 8px;">üìã Bio kopieren</button>
                    <button class="btn btn-video" onclick="game.shareNative()" id="btnNativeShare" style="margin-bottom: 8px;">üì± Native Share</button>
                    <button class="btn" onclick="game.showStart()" id="btnBackShare">Zur√ºck</button>
                </div>
            </div>

            <!-- Game Area -->
            <div id="overlay-game" class="overlay" style="padding: 0; justify-content: flex-start; padding-top: 80px;">
                <div id="view-dice" class="dice-container" style="margin-top: 40px;">
                    <div class="dice" onclick="game.roll()">üé≤</div>
                    <div class="dice" onclick="game.roll()">üî•</div>
                </div>

                <div id="card-action" class="game-card">
                    <div class="card-glow"></div>
                    <div class="card-type" id="typeAction">‚ö° AKTION</div>
                    <div class="card-content" id="text-action"></div>
                    <div id="sub-action" style="color: var(--gold); font-size: 14px; margin-top: 10px;"></div>
                    <button class="btn btn-video" onclick="game.addVideoToTask()" style="margin-top: 15px; font-size: 12px;">üé¨ Video Challenge</button>
                </div>

                <div id="card-quiz" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, var(--accent), transparent);"></div>
                    <div class="card-type" style="color: var(--accent);" id="typeQuiz">üß† QUIZ</div>
                    <div class="card-content" id="text-quiz" style="font-size: 20px;"></div>
                    <div class="quiz-options" id="quiz-options"></div>
                </div>

                <div id="card-tabu" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, var(--success), transparent);"></div>
                    <div class="card-type" style="color: var(--success);" id="typeTabu">üö´ TABU</div>
                    <div class="card-content" id="text-tabu" style="font-size: 26px; font-weight: 600; text-transform: uppercase;"></div>
                    <div class="tabu-forbidden" id="list-tabu"></div>
                </div>

                <div id="card-z" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, var(--danger), transparent);"></div>
                    <div class="card-type" style="color: var(--danger);" id="typeZ">üî• Z√úNDSTOFF</div>
                    <div class="card-content" id="text-z" style="font-size: 22px;"></div>
                    <button class="btn btn-video" onclick="game.addVideoToTask()" style="margin-top: 15px; font-size: 12px;">üé¨ Als Video posten</button>
                </div>

                <div id="card-chaos" class="game-card">
                    <div class="card-glow" style="background: linear-gradient(90deg, transparent, #ff00ff, transparent);"></div>
                    <div class="card-type" style="color: #ff00ff;" id="typeChaos">‚ö†Ô∏è CHAOS</div>
                    <div class="card-content" id="text-chaos" style="color: #ff00ff; font-size: 22px; font-weight: 600;"></div>
                    <div id="sub-chaos" style="color: #888; font-size: 14px; margin-top: 12px;"></div>
                </div>
            </div>

            <!-- Bet Modal -->
            <div id="modal-bet" class="modal">
                <div class="bet-interface">
                    <div class="bet-title" id="betTitle">üî• HIGH STAKES</div>
                    <div class="bet-info" id="betInfo" style="font-size: 13px; color: #888; text-align: center; margin-bottom: 20px;"></div>
                    <input type="text" class="input-field" id="videoUrlInput" placeholder="Video-Link einf√ºgen...">
                    <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                        <button class="btn" onclick="game.setBetRounds(1)" id="btnRounds1" style="flex: 1; height: 60px; font-size: 13px;">
                            <div style="font-size: 16px; font-weight: 700;">1</div>
                            <div style="font-size: 11px;">Runde</div>
                        </button>
                        <button class="btn" onclick="game.setBetRounds(3)" id="btnRounds3" style="flex: 1; height: 60px; font-size: 13px; opacity: 0.5;">
                            <div style="font-size: 16px; font-weight: 700;">3</div>
                            <div style="font-size: 11px;">Runden</div>
                        </button>
                    </div>
                    <div id="betSummary" style="font-size: 13px; color: var(--gold); text-align: center; margin-bottom: 20px;">W√§hle...</div>
                    <button class="btn btn-gold" onclick="game.confirmBet()" id="btnConfirmBet" disabled>Wette Akzeptieren</button>
                    <button class="btn btn-danger" onclick="game.fold()" id="btnFold" style="margin-top: 10px;">Aufgeben</button>
                </div>
            </div>

            <!-- Challenge Modal -->
            <div id="modal-challenge" class="modal">
                <div class="bet-interface">
                    <div class="bet-title" id="challengeTitle">‚öîÔ∏è HERAUSFORDERUNG</div>
                    <div class="bet-info" id="challengeInfo" style="font-size: 13px; color: #888; text-align: center; margin-bottom: 20px;"></div>
                    <div style="background: rgba(212,175,55,0.1); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border);">
                        <div id="currentPotDetails" style="font-size: 14px; color: var(--gold);"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="game.acceptChallenge(1)" id="btnChallenge1" style="flex: 1;">1 Runde<br>Annehmen</button>
                        <button class="btn btn-success" onclick="game.acceptChallenge(3)" style="flex: 1; background: rgba(255,165,0,0.2); color: #ffa500; border-color: rgba(255,165,0,0.3);">3 Runden<br>Risiko x3</button>
                    </div>
                    <button class="btn" onclick="game.declineChallenge()" id="btnDecline" style="margin-top: 12px;">Ablehnen (Out)</button>
                </div>
            </div>

            <!-- Blackjack Modal -->
            <div id="modal-bj" class="modal">
                <div class="glass-card" style="max-width: 360px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 11px; color: var(--gold); letter-spacing: 3px; margin-bottom: 5px; font-weight: 600;">HIGH STAKES CHALLENGE</div>
                        <div style="font-size: 24px; font-weight: 700; letter-spacing: 2px;">üé∞ BLACKJACK</div>
                        <div id="bjRoundInfo" style="font-size: 12px; color: #666; margin-top: 8px;">Runde 1/1</div>
                    </div>

                    <div class="bj-table">
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 10px;">
                            <span id="bjOppName">Gegner</span>
                            <span id="bjOppScore" style="color: var(--gold); font-weight: 700; font-size: 14px;">?</span>
                        </div>
                        <div class="bj-hand" id="bjOppHand"></div>
                    </div>

                    <div class="bj-table" style="border-color: var(--gold); background: rgba(212,175,55,0.08);">
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 10px;">
                            <span id="bjYou">DU</span>
                            <span id="bjPlayerScore" style="color: var(--gold); font-weight: 700; font-size: 14px;">0</span>
                        </div>
                        <div class="bj-hand" id="bjPlayerHand"></div>
                    </div>

                    <div class="btn-group" style="margin-top: 24px;">
                        <button class="btn" onclick="game.bjStand()" id="btnStand" style="height: 54px;">STOP</button>
                        <button class="btn btn-gold" onclick="game.bjHit()" id="btnHit" style="height: 54px;">KARTE</button>
                    </div>
                </div>
            </div>

            <!-- Video Post Modal -->
            <div id="modal-video" class="modal">
                <div class="bet-interface" style="border-color: #ff0066;">
                    <div style="font-size: 24px; margin-bottom: 10px; text-align: center;">üé¨</div>
                    <div style="font-size: 18px; color: #ff0066; margin-bottom: 10px; font-weight: 600; letter-spacing: 1px; text-align: center;">VIDEO CHALLENGE</div>
                    <div style="font-size: 13px; color: #888; margin-bottom: 20px; line-height: 1.5; text-align: center;">
                        F√ºge einen Video-Link (YouTube/TikTok/Instagram) hinzu oder poste dein Ergebnis!
                    </div>
                    <input type="text" class="input-field" id="videoInput" placeholder="https://..." style="border-color: rgba(255,0,100,0.3);">
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="game.closeVideoModal()" style="flex: 1;">Abbrechen</button>
                        <button class="btn btn-video" onclick="game.submitVideo()" style="flex: 1;">Posten</button>
                    </div>
                </div>
            </div>

            <!-- Result -->
            <div id="overlay-result" class="overlay">
                <div class="glass-card" style="text-align: center; padding: 40px;">
                    <div style="font-size: 56px; margin-bottom: 10px;">üèÜ</div>
                    <div style="font-size: 12px; color: #666; letter-spacing: 4px; margin-bottom: 15px; font-weight: 600;" id="resultTitle">SPIEL BEENDET</div>
                    <div id="winnerName" style="font-size: 32px; color: var(--gold); font-weight: 300; letter-spacing: 2px; margin-bottom: 10px;">-</div>
                    <div id="winnerStats" style="font-size: 14px; color: #666; margin-bottom: 35px;"></div>
                    
                    <button class="btn btn-gold" onclick="game.nextRound()" id="btnNextRound" style="margin-bottom: 12px; height: 50px;">Neue Runde</button>
                    <button class="btn" onclick="game.showStart()" style="height: 50px;">Hauptmen√º</button>
                </div>
            </div>

            <div class="player-queue hidden" id="playerQueue"></div>

            <div class="fab-container" id="fabContainer">
                <button class="btn" onclick="game.showBetModal()" id="btnHighStakes" style="background: rgba(255,165,0,0.12); color: #ffa500; border: 1px solid rgba(255,165,0,0.4); margin-bottom: 8px; display: none; animation: pulse 2s infinite;">
                    üé∞ HIGH STAKES
                </button>
                <div class="btn-group" id="gameControls">
                    <button class="btn btn-danger" onclick="game.fail()" id="btnFail">‚úó Fail</button>
                    <button class="btn btn-success" onclick="game.success()" id="btnSuccess">‚úì Geschafft</button>
                </div>
                <button class="btn btn-gold" onclick="game.next()" id="btnNext" style="display: none; height: 54px; margin-top: 5px;">Weiter ‚Üí</button>
            </div>

        </div>
    </div>

<script>
const BOT_PERSONALITIES = [
    { name: "Indica", avatar: "üå∏", successQuotes: {de:["Ganz entspannt...","Ich liebe es hei√ü","Lass dir Zeit"],en:["So relaxed...","I love it hot","Take your time"]}, failQuotes: {de:["Oh, Pech!","Das wird teuer...","Autsch!"],en:["Oh, bad luck!","That'll cost...","Ouch!"]}, quizAccuracy: 0.6, riskTolerance: 0.4 },
    { name: "Aria", avatar: "‚ö°", successQuotes: {de:["Keine Ausreden!","Zieh es aus!","Perfekt."],en:["No excuses!","Take it off!","Perfect."]}, failQuotes: {de:["Unakzeptabel!","Das war schwach."],en:["Unacceptable!","That was weak."]}, quizAccuracy: 0.8, riskTolerance: 0.7 },
    { name: "Luna", avatar: "üåô", successQuotes: {de:["Die Sterne...","Mystisch...","Magisch..."],en:["The stars...","Mystical...","Magical..."]}, failQuotes: {de:["Dunkles Omen...","Karma..."],en:["Dark omen...","Karma..."]}, quizAccuracy: 0.7, riskTolerance: 0.5 },
    { name: "Zoe", avatar: "üé≤", successQuotes: {de:["Ups!","Risky move!"],en:["Oops!","Risky move!"]}, failQuotes: {de:["Oopsie!","Epic fail!"],en:["Oopsie!","Epic fail!"]}, quizAccuracy: 0.5, riskTolerance: 0.85 }
];

const I18N = {
    de: {
        subtitle: "High Stakes AI Edition v3.5", startSubtitle: "High Stakes AI Edition v3.5",
        newGame: "Neues Spiel", demo: "üéÆ Demo (Bots)", rules: "üìã Regeln", share: "üíå Dating Share",
        lobbyTitle: "SPIELER & BOTS", addHuman: "+ Mensch", addBot: "+ KI Bot", back: "Zur√ºck",
        start: "Spiel Starten!", minPlayers: "Min. 2 Spieler",
        rulesTitle: "SPIELREGELN", understood: "Verstanden!",
        shareTitle: "DATING APP SHARE", copyBio: "üìã Bio kopieren", nativeShare: "üì± Native Share",
        betTitle: "üî• HIGH STAKES", betInfo: "Du hast nur noch 1 Item! Setze einen Einsatz mit Video-Link.",
        fold: "Aufgeben (Out)", confirmBet: "Wette Akzeptieren",
        challengeTitle: "‚öîÔ∏è HERAUSFORDERUNG", challengeInfo: "hat einen Einsatz gesetzt. Fordere ihn heraus!",
        currentBet: "Aktueller Einsatz:", play1: "1 Runde<br>Annehmen", play3: "3 Runden<br>Risiko x3", decline: "Ablehnen (Out)",
        bjRound: "Runde", bjStand: "STOP", bjHit: "KARTE",
        resultTitle: "SPIEL BEENDET", nextRound: "Neue Runde", mainMenu: "Hauptmen√º",
        highStakes: "üé∞ HIGH STAKES",
        fail: "‚úó Fail", success: "‚úì Geschafft", next: "Weiter ‚Üí",
        types: { action: "‚ö° AKTION", quiz: "üß† QUIZ", tabu: "üö´ TABU", z: "üî• Z√úNDSTOFF", chaos: "‚ö†Ô∏è CHAOS" },
        rulesText: `<h3 style="color:var(--gold);margin-bottom:10px;">üéÆ Ziel</h3><p style="margin-bottom:15px;">√úberstehe das Spiel mit den meisten Kleidungsst√ºcken.</p><h3 style="color:var(--gold);margin-bottom:10px;">üìã Kategorien</h3><ul style="margin-left:20px;margin-bottom:15px;line-height:1.8;"><li>‚ö° Aktion: Tausche, Kitzle, fl√ºstere</li><li>üß† Quiz: Beantworte richtig</li><li>üö´ Tabu: Erkl√§re ohne Wortliste</li><li>üî• Z√ºndstoff: Intime Wahrheiten</li><li>‚ö†Ô∏è Chaos: Spezialeffekte</li></ul><h3 style="color:var(--gold);margin-bottom:10px;">üí∞ High Stakes</h3><p>Bei 1 Item: Setze Video-Einsatz. Andere k√∂nnen herausfordern (Blackjack).</p>`,
        decks: {
            actions: [
                {t: "Tausche dein Oberteil mit links", i: 3}, {t: "Lass dich 30s kitzeln", i: 2},
                {t: "Fl√ºstere ein Geheimnis ins Ohr", i: 4}, {t: "Trinke ohne H√§nde", i: 3},
                {t: "Mach ein anz√ºgliches Kompliment", i: 2}, {t: "Ziehe ein Kleidungsst√ºck aus", i: 5},
                {t: "Wahrheit oder Strip?", i: 4}, {t: "Simuliere sexy Werbung", i: 3}
            ],
            quiz: [
                {q: "Wie viele Schritte pro Tag?", a: ["3.000", "10.000", "15.000"], c: 1},
                {q: "Gr√∂√ütes innere Organ?", a: ["Herz", "Leber", "Lunge"], c: 1},
                {q: "Z√§hne Erwachsener?", a: ["28", "32", "36"], c: 1},
                {q: "Erstes iPhone Jahr?", a: ["2005", "2007", "2009"], c: 1},
                {q: "Hauptstadt Australiens?", a: ["Sydney", "Melbourne", "Canberra"], c: 2},
                {q: "Planeten im Sonnensystem?", a: ["7", "8", "9"], c: 1}
            ],
            tabu: [
                {w: "Orgasmus", f: ["H√∂hepunkt", "Lust", "Kommen"]}, {w: "Kondom", f: ["Gummi", "Schutz", "Verh√ºtung"]},
                {w: "Tinder", f: ["Dating", "Swipe", "Match"]}, {w: "Striptease", f: ["Ausziehen", "Tanz", "Club"]},
                {w: "One-Night-Stand", f: ["Sex", "Nacht", "Fremder"]}, {w: "Viagra", f: ["Potenz", "Pille", "Stehen"]}
            ],
            z: ["Geheimste sexuelle Fantasie?", "Mit wem hier w√ºrdest du schlafen?", "Verruchteste Tat?", "Letzter Sex-Traum?", 
                "Welche K√∂rperstelle macht dich an?", "Lieblingsstellung?"]
        },
        chaos: [
            {n: "üîÑ IDENTIT√ÑTSTAUSCH", t: "Tausche deine Identit√§t!", d: "Du spielst als die Person rechts.", e: "swap"},
            {n: "üí• DOPPELTER EINSATZ", t: "Alles z√§hlt doppelt!", d: "Strips werden verdoppelt.", e: "double"},
            {n: "üé∞ ZWANGS-BLACKJACK", t: "Nur Blackjack z√§hlt!", d: "Verlust = -3 Items", e: "bjforced"},
            {n: "üîÑ RICHTUNGSWECHSEL", t: "Links wird Rechts", d: "Die Richtungen sind vertauscht.", e: "reverse"},
            {n: "‚öîÔ∏è ALLE GEGEN ALLE", t: "Jeder gegen Jeden!", d: "N√§chste Runde: Wer verliert, strippt sofort.", e: "allvsall"}
        ]
    },
    en: {
        subtitle: "High Stakes AI Edition v3.5", startSubtitle: "High Stakes AI Edition v3.5",
        newGame: "New Game", demo: "üéÆ Demo (Bots)", rules: "üìã Rules", share: "üíå Dating Share",
        lobbyTitle: "PLAYERS & BOTS", addHuman: "+ Human", addBot: "+ AI Bot", back: "Back",
        start: "Start Game!", minPlayers: "Need 2 players",
        rulesTitle: "RULES", understood: "Got it!",
        shareTitle: "DATING APP SHARE", copyBio: "üìã Copy Bio", nativeShare: "üì± Native Share",
        betTitle: "üî• HIGH STAKES", betInfo: "You have only 1 item left! Place a bet with video link.",
        fold: "Fold (Out)", confirmBet: "Confirm Bet",
        challengeTitle: "‚öîÔ∏è CHALLENGE", challengeInfo: "placed a bet. Challenge them!",
        currentBet: "Current Bet:", play1: "1 Round<br>Play", play3: "3 Rounds<br>Risk x3", decline: "Decline (Out)",
        bjRound: "Round", bjStand: "STAND", bjHit: "HIT",
        resultTitle: "GAME OVER", nextRound: "Next Round", mainMenu: "Main Menu",
        highStakes: "üé∞ HIGH STAKES",
        fail: "‚úó Fail", success: "‚úì Success", next: "Next ‚Üí",
        types: { action: "‚ö° ACTION", quiz: "üß† QUIZ", tabu: "üö´ TABOO", z: "üî• DARE", chaos: "‚ö†Ô∏è CHAOS" },
        rulesText: `<h3 style="color:var(--gold);margin-bottom:10px;">üéÆ Goal</h3><p style="margin-bottom:15px;">Survive with the most clothing items.</p><h3 style="color:var(--gold);margin-bottom:10px;">üìã Categories</h3><ul style="margin-left:20px;margin-bottom:15px;line-height:1.8;"><li>‚ö° Action: Swap, tickle, whisper</li><li>üß† Quiz: Answer correctly</li><li>üö´ Taboo: Explain without word list</li><li>üî• Dare: Intimate truths</li><li>‚ö†Ô∏è Chaos: Special effects</li></ul><h3 style="color:var(--gold);margin-bottom:10px;">üí∞ High Stakes</h3><p>At 1 item: Place video bet. Others can challenge (Blackjack).</p>`,
        decks: {
            actions: [
                {t: "Swap shirt with left person", i: 3}, {t: "Get tickled for 30s", i: 2},
                {t: "Whisper a secret in ear", i: 4}, {t: "Drink without hands", i: 3},
                {t: "Give a dirty compliment", i: 2}, {t: "Remove clothing", i: 5}
            ],
            quiz: [
                {q: "Steps per day (average)?", a: ["3,000", "10,000", "15,000"], c: 1},
                {q: "Largest internal organ?", a: ["Heart", "Liver", "Lung"], c: 1},
                {q: "Adult teeth?", a: ["28", "32", "36"], c: 1},
                {q: "First iPhone year?", a: ["2005", "2007", "2009"], c: 1},
                {q: "Capital of Australia?", a: ["Sydney", "Melbourne", "Canberra"], c: 2},
                {q: "Planets in solar system?", a: ["7", "8", "9"], c: 1}
            ],
            tabu: [
                {w: "Orgasm", f: ["Climax", "Pleasure", "Come"]}, {w: "Condom", f: ["Rubber", "Protection", "Safe"]},
                {w: "Tinder", f: ["Dating", "Swipe", "Match"]}, {w: "Striptease", f: ["Undress", "Dance", "Club"]},
                {w: "One-Night-Stand", f: ["Sex", "Night", "Stranger"]}, {w: "Viagra", f: ["Potency", "Pill", "Hard"]}
            ],
            z: ["Secret sexual fantasy?", "Who here would you sleep with?", "Naughtiest deed?", "Last sex dream?", 
                "Which body part turns you on?", "Favorite position?"]
        },
        chaos: [
            {n: "üîÑ IDENTITY SWAP", t: "Swap your identity!", d: "You play as person on right.", e: "swap"},
            {n: "üí• DOUBLE STRIP", t: "Everything counts double!", d: "Strips are doubled.", e: "double"},
            {n: "üé∞ FORCED BLACKJACK", t: "Only Blackjack counts!", d: "Loss = -3 Items", e: "bjforced"},
            {n: "üîÑ REVERSE", t: "Left becomes Right", d: "Directions swapped.", e: "reverse"},
            {n: "‚öîÔ∏è FREE FOR ALL", t: "Everyone against everyone!", d: "Next round: Loser strips immediately.", e: "allvsall"}
        ]
    }
};

class FlowController {
    constructor(lang) {
        this.lang = lang;
        this.energy = 50;
        this.history = [];
        this.chaosCooldown = 0;
        this.lastCategories = [];
    }

    selectNextCategory(forceChaos = false) {
        if (forceChaos || (this.chaosCooldown >= 4 && Math.random() < 0.3)) {
            this.chaosCooldown = 0;
            this.energy = Math.min(100, this.energy + 30);
            return 'chaos';
        }
        this.chaosCooldown++;

        const categories = ['action', 'quiz', 'tabu', 'z'];
        const available = categories.filter(c => !this.lastCategories.includes(c));
        const pool = available.length > 0 ? available : categories;
        
        let weights = {};
        pool.forEach(c => {
            if (this.energy > 75) weights[c] = (c === 'quiz' || c === 'tabu') ? 3 : 1;
            else if (this.energy < 30) weights[c] = (c === 'action' || c === 'z') ? 3 : 1;
            else weights[c] = 2;
        });

        const result = this.weightedRandom(pool, weights);
        this.updateEnergy(result);
        this.lastCategories.push(result);
        if (this.lastCategories.length > 2) this.lastCategories.shift();
        return result;
    }

    getChaosEvent() {
        const events = I18N[this.lang]?.chaos || I18N['de'].chaos;
        return events[Math.floor(Math.random() * events.length)];
    }

    updateEnergy(category) {
        const changes = {'action': +15, 'quiz': -10, 'tabu': -5, 'z': +20, 'chaos': +30};
        this.energy = Math.max(0, Math.min(100, this.energy + (changes[category] || 0)));
    }

    weightedRandom(items, weights) {
        const total = Object.values(weights).reduce((a,b) => a+b, 0);
        let random = Math.random() * total;
        for (let item of items) {
            random -= weights[item];
            if (random <= 0) return item;
        }
        return items[0];
    }

    getUniqueTask(category, deck) {
        const recentTasks = this.history.slice(-6).map(h => JSON.stringify(h.task));
        let attempts = 0;
        let task;
        do {
            task = this.getRandomFromDeck(category, deck);
            attempts++;
        } while (recentTasks.includes(JSON.stringify(task)) && attempts < 10);
        
        this.history.push({type: category, task, time: Date.now()});
        if (this.history.length > 20) this.history.shift();
        return task;
    }

    getRandomFromDeck(cat, deck) {
        const arr = deck[cat === 'z' ? 'z' : cat === 'action' ? 'actions' : cat === 'quiz' ? 'quiz' : 'tabu'];
        if (!arr) return null;
        return arr[Math.floor(Math.random() * arr.length)];
    }
}

class Game {
    constructor() {
        this.lang = 'de';
        this.flow = new FlowController('de');
        this.players = [];
        this.currentPlayerIdx = 0;
        this.gameActive = false;
        this.pot = null;
        this.bj = null;
        this.betRounds = 1;
        this.currentVideoUrl = null;
        this.stripMultiplier = 1;
        this.reverseDirection = false;
        
        this.initLanguageSelector();
        this.updateTimestamp();
        setInterval(() => this.updateTimestamp(), 60000);
    }

    initLanguageSelector() {
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const lang = e.target.dataset.lang;
                if (lang) this.setLanguage(lang);
            });
        });
    }

    setLanguage(lang) {
        this.lang = lang;
        this.flow = new FlowController(lang);
        
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.lang === lang);
        });

        this.updateUILanguage();
        
        if (document.getElementById('overlay-language').classList.contains('active')) {
            document.getElementById('overlay-language').classList.remove('active');
            document.getElementById('overlay-start').classList.add('active');
            document.getElementById('langSelector').style.display = 'flex';
        }
    }

    updateUILanguage() {
        const t = I18N[this.lang] || I18N['de'];
        
        document.getElementById('startSubtitle').textContent = t.startSubtitle;
        document.getElementById('btnNewGame').textContent = t.newGame;
        document.getElementById('btnDemo').textContent = t.demo;
        document.getElementById('btnRules').textContent = t.rules;
        document.getElementById('btnShare').textContent = t.share;
        document.getElementById('lobbyTitle').textContent = t.lobbyTitle;
        document.getElementById('btnAddHuman').textContent = t.addHuman;
        document.getElementById('btnAddBot').textContent = t.addBot;
        document.getElementById('btnBack').textContent = t.back;
        document.getElementById('rulesTitle').textContent = t.rulesTitle;
        document.getElementById('btnUnderstood').textContent = t.understood;
        document.getElementById('shareTitle').textContent = t.shareTitle;
        document.getElementById('btnCopyBio').textContent = t.copyBio;
        document.getElementById('btnNativeShare').textContent = t.nativeShare;
        document.getElementById('btnBackShare').textContent = t.back;
        document.getElementById('betTitle').textContent = t.betTitle;
        document.getElementById('betInfo').innerHTML = t.betInfo;
        document.getElementById('btnFold').textContent = t.fold;
        document.getElementById('btnConfirmBet').textContent = t.confirmBet;
        document.getElementById('challengeTitle').textContent = t.challengeTitle;
        document.getElementById('btnDecline').textContent = t.decline;
        document.getElementById('btnChallenge1').innerHTML = t.play1;
        document.getElementById('resultTitle').textContent = t.resultTitle;
        document.getElementById('btnNextRound').textContent = t.nextRound;
        document.getElementById('typeAction').textContent = t.types.action;
        document.getElementById('typeQuiz').textContent = t.types.quiz;
        document.getElementById('typeTabu').textContent = t.types.tabu;
        document.getElementById('typeZ').textContent = t.types.z;
        document.getElementById('typeChaos').textContent = t.types.chaos;
        document.getElementById('btnFail').textContent = t.fail;
        document.getElementById('btnSuccess').textContent = t.success;
        document.getElementById('btnNext').textContent = t.next;
        document.getElementById('btnStand').textContent = t.bjStand;
        document.getElementById('btnHit').textContent = t.bjHit;
        
        document.getElementById('rulesText').innerHTML = t.rulesText;
        
        this.updateLobby();
    }

    showLanguage() {
        this.hideAllOverlays();
        document.getElementById('overlay-language').classList.add('active');
    }

    showStart() {
        this.hideAllOverlays();
        document.getElementById('overlay-start').classList.add('active');
        document.getElementById('playerQueue').classList.add('hidden');
        document.getElementById('fabContainer').classList.remove('active');
        document.getElementById('langSelector').style.display = 'flex';
    }

    showLobby() {
        this.players = [];
        this.addPlayer(false, "Player 1");
        this.addPlayer(false, "Player 2");
        this.hideAllOverlays();
        document.getElementById('overlay-lobby').classList.add('active');
        document.getElementById('langSelector').style.display = 'flex';
    }

    addPlayer(isBot = false, defaultName = null) {
        if (this.players.length >= 8) return;
        
        const input = document.getElementById('playerName');
        let name;
        
        if (isBot) {
            const botIdx = this.players.filter(p => p.isBot).length % 4;
            name = BOT_PERSONALITIES[botIdx].name;
        } else {
            name = defaultName || input.value.trim() || `Player ${this.players.length + 1}`;
        }
        
        const player = {
            id: this.players.length,
            name: name,
            items: 5,
            isBot: isBot,
            personality: isBot ? BOT_PERSONALITIES[this.players.filter(p => p.isBot).length % 4] : null,
            out: false,
            score: 0,
            betMade: false
        };
        
        this.players.push(player);
        if (!defaultName) input.value = '';
        this.updateLobby();
    }

    updateLobby() {
        const list = document.getElementById('lobbyList');
        const t = I18N[this.lang] || I18N['de'];
        
        list.innerHTML = this.players.map((p, i) => `
            <div class="lobby-item ${p.isBot ? 'bot' : ''}">
                <span style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 16px;">${p.isBot ? p.personality.avatar : 'üë§'}</span>
                    <span>${p.name}</span>
                </span>
                ${this.players.length > 2 ? 
                    `<button class="remove-btn" onclick="game.removePlayer(${i})">‚úï</button>` : 
                    '<div style="width:32px;"></div>'}
            </div>
        `).join('');
        
        const canStart = this.players.length >= 2;
        const btnStart = document.getElementById('btnStart');
        btnStart.disabled = !canStart;
        btnStart.style.opacity = canStart ? '1' : '0.5';
        btnStart.textContent = canStart ? t.start : t.minPlayers;
    }

    removePlayer(idx) {
        this.players.splice(idx, 1);
        this.players.forEach((p, i) => p.id = i);
        this.updateLobby();
    }

    startGame() {
        if (this.players.length < 2) return;
        this.gameActive = true;
        this.flow = new FlowController(this.lang);
        this.currentPlayerIdx = 0;
        this.pot = null;
        
        this.players.forEach(p => {
            p.items = 5;
            p.out = false;
            p.score = 0;
            p.betMade = false;
        });
        
        this.hideAllOverlays();
        document.getElementById('overlay-game').classList.add('active');
        document.getElementById('fabContainer').classList.add('active');
        document.getElementById('playerQueue').classList.remove('hidden');
        document.getElementById('potIndicator').classList.remove('active');
        
        this.updateQueue();
        document.getElementById('view-dice').style.display = 'flex';
    }

    roll() {
        const dice = document.querySelectorAll('.dice');
        dice.forEach(d => {
            d.classList.add('rolling');
            d.style.pointerEvents = 'none';
        });
        
        setTimeout(() => {
            dice.forEach(d => {
                d.classList.remove('rolling');
                d.style.pointerEvents = 'auto';
            });
            document.getElementById('view-dice').style.display = 'none';
            this.nextCard();
        }, 700);
    }

    nextCard() {
        if (!this.gameActive) return;
        
        const cat = this.flow.selectNextCategory();
        const deck = (I18N[this.lang] || I18N['de']).decks;
        
        document.querySelectorAll('.game-card').forEach(c => c.classList.remove('active'));
        
        if (cat === 'chaos') {
            const chaos = this.flow.getChaosEvent();
            this.handleChaosEvent(chaos);
        } else {
            const task = this.flow.getUniqueTask(cat, deck);
            this.showCard(cat, task);
        }
        
        const p = this.players[this.currentPlayerIdx];
        document.getElementById('gameControls').style.display = 'flex';
        document.getElementById('btnNext').style.display = 'none';
        
        if (p.isBot) {
            document.getElementById('gameControls').style.opacity = '0.3';
            document.getElementById('gameControls').style.pointerEvents = 'none';
            this.autoBotTurn();
        } else {
            document.getElementById('gameControls').style.opacity = '1';
            document.getElementById('gameControls').style.pointerEvents = 'auto';
        }
    }

    showCard(cat, task) {
        const card = document.getElementById(`card-${cat}`);
        
        if (cat === 'action') {
            document.getElementById('text-action').textContent = task.t;
            document.getElementById('sub-action').textContent = 'üî•'.repeat(task.i);
        } else if (cat === 'quiz') {
            document.getElementById('text-quiz').textContent = task.q;
            const opts = document.getElementById('quiz-options');
            opts.innerHTML = task.a.map((a, i) => 
                `<button class="btn" onclick="game.answerQuiz(${i === task.c})" style="text-transform: none; font-size: 14px;">${a}</button>`
            ).join('');
        } else if (cat === 'tabu') {
            document.getElementById('text-tabu').textContent = task.w;
            document.getElementById('list-tabu').innerHTML = task.f.map(f => 
                `<div class="tabu-word">${f}</div>`
            ).join('');
        } else if (cat === 'z') {
            document.getElementById('text-z').textContent = task;
        }
        
        card.classList.add('active');
        
        if (cat === 'quiz') {
            document.getElementById('gameControls').style.display = 'none';
        }
    }

    handleChaosEvent(chaos) {
        document.getElementById('card-chaos').classList.add('active');
        document.getElementById('text-chaos').textContent = chaos.n;
        document.getElementById('sub-chaos').textContent = chaos.d;
        
        if (chaos.e === 'swap') {
            const next = (this.currentPlayerIdx + 1) % this.players.length;
            if (!this.players[this.currentPlayerIdx].out && !this.players[next].out) {
                const temp = this.players[this.currentPlayerIdx].name;
                this.players[this.currentPlayerIdx].name = this.players[next].name;
                this.players[next].name = temp;
                this.showToast('üîÑ Identit√§ten getauscht!');
            }
        } else if (chaos.e === 'double') {
            this.stripMultiplier = 2;
        } else if (chaos.e === 'reverse') {
            this.reverseDirection = !this.reverseDirection;
        } else if (chaos.e === 'bjforced') {
            this.stripMultiplier = 3;
        }
        
        document.getElementById('gameControls').style.display = 'none';
        document.getElementById('btnNext').style.display = 'block';
    }

    answerQuiz(correct) {
        if (correct) this.success();
        else this.fail();
    }

    success() {
        const p = this.players[this.currentPlayerIdx];
        p.score++;
        if (p.isBot) {
            const quotes = p.personality.successQuotes[this.lang] || p.personality.successQuotes['de'];
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            this.showBotBubble(`${p.personality.avatar} ${p.name}`, quote);
        }
        this.showNextButton();
    }

    fail() {
        const p = this.players[this.currentPlayerIdx];
        const loss = this.stripMultiplier;
        p.items = Math.max(0, p.items - loss);
        
        if (p.isBot) {
            const quotes = p.personality.failQuotes[this.lang] || p.personality.failQuotes['de'];
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            this.showBotBubble(`${p.personality.avatar} ${p.name}`, quote);
        }
        
        if (p.items === 0 && !p.out && !p.betMade) {
            setTimeout(() => this.offerBet(), 800);
        } else if (p.items === 0 && p.betMade) {
            p.out = true;
            this.showBotBubble('üíÄ OUT', `${p.name} ist raus!`);
            this.showNextButton();
        } else {
            this.showNextButton();
        }
    }

    showNextButton() {
        document.getElementById('gameControls').style.display = 'none';
        document.getElementById('btnNext').style.display = 'block';
        
        const p = this.players[this.currentPlayerIdx];
        if (p.isBot) {
            setTimeout(() => this.next(), 1500);
        }
    }

    next() {
        this.stripMultiplier = 1;
        const direction = this.reverseDirection ? -1 : 1;
        let nextIdx = (this.currentPlayerIdx + direction + this.players.length) % this.players.length;
        
        let attempts = 0;
        while (this.players[nextIdx].out && attempts < this.players.length) {
            nextIdx = (nextIdx + direction + this.players.length) % this.players.length;
            attempts++;
        }
        
        if (attempts >= this.players.length) {
            this.endGame();
            return;
        }
        
        this.currentPlayerIdx = nextIdx;
        this.updateQueue();
        
        document.querySelectorAll('.game-card').forEach(c => c.classList.remove('active'));
        document.getElementById('view-dice').style.display = 'flex';
        document.getElementById('gameControls').style.display = 'flex';
        document.getElementById('btnNext').style.display = 'none';
    }

    updateQueue() {
        const queue = document.getElementById('playerQueue');
        const p = this.players[this.currentPlayerIdx];
        
        if (p && p.items <= 1 && !p.out) queue.classList.add('compact');
        else queue.classList.remove('compact');
        
        queue.innerHTML = this.players.map((player, i) => {
            if (player.out) return '';
            const isActive = i === this.currentPlayerIdx;
            const isPotOwner = this.pot && this.pot.owner === i;
            return `
                <div class="player-chip ${isActive ? 'active' : ''} ${player.isBot ? 'bot' : ''} ${isPotOwner ? 'pot-owner' : ''}">
                    <span>${player.isBot ? player.personality.avatar : 'üë§'}</span>
                    <span>${player.name}</span>
                    <span style="opacity: 0.8; font-size: 11px;">(${player.items}üß•)</span>
                </div>
            `;
        }).join('');
        
        const btn = document.getElementById('btnHighStakes');
        if (p && p.items <= 1 && !p.out && !this.pot) {
            btn.style.display = 'block';
        } else {
            btn.style.display = 'none';
        }
    }

    offerBet() {
        const p = this.players[this.currentPlayerIdx];
        if (!p || p.items > 0 || p.out) return;
        
        document.getElementById('modal-bet').classList.add('active');
        document.getElementById('videoUrlInput').value = '';
        this.setBetRounds(1);
    }

    showBetModal() {
        this.offerBet();
    }

    setBetRounds(r) {
        this.betRounds = r;
        document.getElementById('btnRounds1').style.opacity = r === 1 ? '1' : '0.5';
        document.getElementById('btnRounds3').style.opacity = r === 3 ? '1' : '0.5';
        
        const t = I18N[this.lang] || I18N['de'];
        const time = 10 * r;
        document.getElementById('betSummary').innerHTML = `
            1 Item √ó 10s √ó ${r} = <strong>${time}s Video</strong><br>
            <small style="color: var(--text-secondary)">${r === 3 ? 'Gewinn: +3 Items' : 'Gewinn: +1 Item'}</small>
        `;
        document.getElementById('btnConfirmBet').disabled = false;
    }

    confirmBet() {
        const url = document.getElementById('videoUrlInput').value.trim();
        if (!url) {
            this.showToast('‚ùå Video-Link erforderlich!');
            return;
        }
        
        const p = this.players[this.currentPlayerIdx];
        
        this.pot = {
            owner: this.currentPlayerIdx,
            videoUrl: url,
            rounds: this.betRounds,
            items: this.betRounds,
            claimed: false
        };
        
        p.betMade = true;
        p.items = 0;
        
        document.getElementById('modal-bet').classList.remove('active');
        document.getElementById('potIndicator').classList.add('active');
        document.getElementById('potText').textContent = `POT: ${this.pot.items}`;
        
        this.showBotBubble('üé∞ HIGH STAKES', `${p.name} setzt ${this.pot.items} Items!`);
        this.next();
    }

    fold() {
        const p = this.players[this.currentPlayerIdx];
        p.out = true;
        document.getElementById('modal-bet').classList.remove('active');
        this.showBotBubble('üíÄ OUT', `${p.name} hat aufgegeben!`);
        this.next();
    }

    checkChallenge() {
        const currentP = this.players[this.currentPlayerIdx];
        if (this.pot && this.pot.owner !== currentP.id && !currentP.betMade && !currentP.out) {
            document.getElementById('modal-challenge').classList.add('active');
            const owner = this.players[this.pot.owner];
            const t = I18N[this.lang] || I18N['de'];
            document.getElementById('challengeInfo').innerHTML = `<strong>${owner.name}</strong> ${t.challengeInfo}`;
            document.getElementById('currentPotDetails').innerHTML = `${this.pot.items} Items<br>${this.pot.videoUrl}`;
        }
    }

    acceptChallenge(rounds) {
        const p = this.players[this.currentPlayerIdx];
        this.pot.challenger = this.currentPlayerIdx;
        this.pot.challengeRounds = rounds;
        document.getElementById('modal-challenge').classList.remove('active');
        this.startBlackjack();
    }

    declineChallenge() {
        const p = this.players[this.currentPlayerIdx];
        p.out = true;
        document.getElementById('modal-challenge').classList.remove('active');
        this.next();
    }

    startBlackjack() {
        const owner = this.players[this.pot.owner];
        const challenger = this.players[this.pot.challenger];
        
        this.bj = {
            challenger: this.pot.challenger,
            owner: this.pot.owner,
            deck: this.createDeck(),
            ph: [],
            oh: [],
            round: 1,
            maxRounds: this.pot.challengeRounds || 1
        };
        
        this.bj.ph.push(this.bj.deck.pop(), this.bj.deck.pop());
        this.bj.oh.push(this.bj.deck.pop(), this.bj.deck.pop());
        
        const t = I18N[this.lang] || I18N['de'];
        document.getElementById('bjOppName').textContent = owner.name;
        document.getElementById('bjRoundInfo').textContent = `${t.bjRound} ${this.bj.round}/${this.bj.maxRounds}`;
        
        document.getElementById('modal-bj').classList.add('active');
        this.updateBjUI();
    }

    createDeck() {
        const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
        const values = [
            {v:2,l:'2'},{v:3,l:'3'},{v:4,l:'4'},{v:5,l:'5'},
            {v:6,l:'6'},{v:7,l:'7'},{v:8,l:'8'},{v:9,l:'9'},
            {v:10,l:'10'},{v:10,l:'J'},{v:10,l:'Q'},{v:10,l:'K'},{v:11,l:'A'}
        ];
        let deck = [];
        for(let s of suits) {
            for(let v of values) {
                deck.push({...v, s:s});
            }
        }
        for(let i=deck.length-1; i>0; i--) {
            const j = Math.floor(Math.random()*(i+1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
        return deck;
    }

    calcHand(hand) {
        let sum = 0, aces = 0;
        for(let c of hand) {
            sum += c.v;
            if(c.l === 'A') aces++;
        }
        while(sum > 21 && aces > 0) {
            sum -= 10;
            aces--;
        }
        return sum;
    }

    updateBjUI() {
        const render = (hand, hide=false) => {
            return hand.map((c,i) => {
                if(hide && i === 1) return '<div class="bj-card hidden"></div>';
                const isRed = c.s === '‚ô•' || c.s === '‚ô¶';
                return `<div class="bj-card ${isRed?'red':''}">${c.l}${c.s}</div>`;
            }).join('');
        };

        document.getElementById('bjPlayerHand').innerHTML = render(this.bj.ph);
        document.getElementById('bjPlayerScore').textContent = this.calcHand(this.bj.ph);
        document.getElementById('bjOppHand').innerHTML = render(this.bj.oh, true);
        document.getElementById('bjOppScore').textContent = '?';
    }

    bjHit() {
        this.bj.ph.push(this.bj.deck.pop());
        this.updateBjUI();
        if(this.calcHand(this.bj.ph) >= 21) {
            setTimeout(() => this.bjStand(), 500);
        }
    }

    bjStand() {
        let oppScore = this.calcHand(this.bj.oh);
        while(oppScore < 17) {
            this.bj.oh.push(this.bj.deck.pop());
            oppScore = this.calcHand(this.bj.oh);
        }
        
        document.getElementById('bjOppHand').innerHTML = this.bj.oh.map(c => {
            const isRed = c.s === '‚ô•' || c.s === '‚ô¶';
            return `<div class="bj-card ${isRed?'red':''}">${c.l}${c.s}</div>`;
        }).join('');
        document.getElementById('bjOppScore').textContent = oppScore;
        
        setTimeout(() => this.resolveBjRound(), 1000);
    }

    resolveBjRound() {
        const pScore = this.calcHand(this.bj.ph);
        const oScore = this.calcHand(this.bj.oh);
        const challenger = this.players[this.bj.challenger];
        const owner = this.players[this.bj.owner];
        
        let challengerWon = false;
        if(pScore > 21) challengerWon = false;
        else if(oScore > 21) challengerWon = true;
        else if(pScore > oScore) challengerWon = true;
        else challengerWon = false;
        
        if(challengerWon) {
            challenger.items += this.pot.items;
            challenger.betMade = false;
            this.showToast(`üèÜ ${challenger.name} gewinnt ${this.pot.items} Items!`);
            this.resolvePot();
        } else {
            challenger.out = true;
            owner.items = this.pot.items;
            owner.betMade = false;
            this.showToast(`‚ùå ${challenger.name} verliert!`);
            this.resolvePot();
        }
        
        document.getElementById('modal-bj').classList.remove('active');
        this.bj = null;
        this.next();
    }

    resolvePot() {
        if (this.pot) {
            this.pot = null;
            document.getElementById('potIndicator').classList.remove('active');
        }
    }

    endGame() {
        this.gameActive = false;
        this.hideAllOverlays();
        document.getElementById('overlay-result').classList.add('active');
        document.getElementById('playerQueue').classList.add('hidden');
        document.getElementById('fabContainer').classList.remove('active');
        
        const active = this.players.filter(p => !p.out);
        let winner = null;
        
        if (active.length === 0) winner = null;
        else if (active.length === 1) winner = active[0];
        else winner = active.reduce((a, b) => a.items > b.items ? a : b);
        
        if (winner) {
            document.getElementById('winnerName').textContent = winner.name + (winner.isBot ? ` ${winner.personality.avatar}` : ' üëë');
            document.getElementById('winnerStats').textContent = `${winner.items} Items | Score: ${winner.score}`;
        } else {
            document.getElementById('winnerName').textContent = 'Unentschieden!';
            document.getElementById('winnerStats').textContent = '';
        }
    }

    nextRound() {
        this.showLobby();
    }

    demoMode() {
        this.players = [];
        for (let i = 0; i < 4; i++) {
            const botIdx = i % 4;
            this.players.push({
                id: i,
                name: BOT_PERSONALITIES[botIdx].name,
                items: 5,
                isBot: true,
                personality: BOT_PERSONALITIES[botIdx],
                out: false,
                score: 0,
                betMade: false
            });
        }
        this.startGame();
        this.showBotBubble('üéÆ DEMO', 'KI-Bots spielen automatisch!');
    }

    autoBotTurn() {
        const p = this.players[this.currentPlayerIdx];
        if (!p || !p.isBot) return;
        
        setTimeout(() => {
            let success = false;
            if (this.flow.lastCategories[this.flow.lastCategories.length-1] === 'quiz') {
                success = Math.random() < p.personality.quizAccuracy;
            } else {
                success = Math.random() > 0.3;
            }
            success ? this.success() : this.fail();
        }, 2000);
    }

    showBotBubble(name, text) {
        document.getElementById('botSpeakerName').textContent = name;
        document.getElementById('botSpeech').textContent = text;
        document.getElementById('botAvatar').textContent = name.includes('üå∏') ? 'üå∏' : name.includes('‚ö°') ? '‚ö°' : name.includes('üåô') ? 'üåô' : name.includes('üé≤') ? 'üé≤' : 'ü§ñ';
        const bubble = document.getElementById('botBubble');
        bubble.classList.add('active');
        if (this.bubbleTimeout) clearTimeout(this.bubbleTimeout);
        this.bubbleTimeout = setTimeout(() => bubble.classList.remove('active'), 4000);
    }

    showToast(msg) {
        const existing = document.querySelector('.toast');
        if (existing) existing.remove();
        
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = msg;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    showRules() {
        this.hideAllOverlays();
        document.getElementById('overlay-rules').classList.add('active');
    }

    // HIER IST DIE NEUE FUNKTION closeRules():
    closeRules() {
        document.getElementById('overlay-rules').classList.remove('active');
        if (this.gameActive) {
            // Wenn im Spiel: Zur√ºck zum Spiel-Overlay
            document.getElementById('overlay-game').classList.add('active');
        } else {
            // Wenn im Men√º: Zur√ºck zum Start-Screen
            document.getElementById('overlay-start').classList.add('active');
        }
    }

    showShare() {
        this.hideAllOverlays();
        document.getElementById('overlay-share').classList.add('active');
    }

    copyToClipboard(type) {
        const text = "üî• FUNKENFLUG v3.5! High Stakes Party-Game mit KI-Bots, Video-Challenges & Blackjack. Trau dich?";
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(() => this.showToast('üìã Kopiert!'));
        }
    }

    shareNative() {
        if (navigator.share) {
            navigator.share({
                title: 'FUNKENFLUG v3.5',
                text: 'üî• High Stakes Party-Game mit KI-Bots & Video-Challenges!',
                url: window.location.href
            });
        } else {
            this.copyToClipboard();
        }
    }

    addVideoToTask() {
        document.getElementById('modal-video').classList.add('active');
    }

    closeVideoModal() {
        document.getElementById('modal-video').classList.remove('active');
    }

    submitVideo() {
        const url = document.getElementById('videoInput').value.trim();
        if (url) {
            this.currentVideoUrl = url;
            this.showToast('üé¨ Video hinzugef√ºgt!');
            this.closeVideoModal();
        }
    }

    hideAllOverlays() {
        document.querySelectorAll('.overlay').forEach(o => o.classList.remove('active'));
        document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
    }

    updateTimestamp() {
        const now = new Date();
        document.getElementById('timestamp').textContent = now.toLocaleDateString('de-DE') + ' ' + 
            now.toLocaleTimeString('de-DE', {hour:'2-digit', minute:'2-digit'});
    }
}

const game = new Game();
</script>
</body>
</html>
